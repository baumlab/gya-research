---
title: "gya-survey-report"
author: "James Robinson; Kristina Tietjen"
date: "18 July 2016"
output: html_document
---

```{r, echo=FALSE, hide=TRUE}
## load in survey data

setwd("/Users/kristinatietjen/Documents/git_hub/gya-research")

survey<-read.csv("data/Jul 18 2016 1149am - Hamilton.csv", header=TRUE)
survey.what<-read.csv(file="data/gya-country-responses.csv")
research<-read.csv(file="data/gya-surveys-cleaned-research.csv")
research.past<-read.csv(file="data/gya-surveys-cleaned-research-past.csv")
research.change<-read.csv(file="data/gya-change-reason.csv")
part4<-read.csv(file="data/gya-survey-part4")

## load required packages
require(gridExtra); require(tidyr); require(ggplot2); require(stringr)
theme_set(theme_bw())
```

### GYA surveys: summary statistics

As of `r date()`, `r dim(survey.what)[1]` from `r length(unique(survey.what$Country_work))` countries have been completed.

The majority of surveys were completed by researchers based in Canada (n = `r dim(survey.what[survey.what$Country_work=="Canada",])[1]`), followed by Israel (n = `r dim(survey.what[survey.what$Country_work=="Israel",])[1]`) then by USA (n = `r dim(survey.what[survey.what$Country_work=="United States",])[1]`) and the UK (n = `r dim(survey.what[survey.what$Country_work=="United Kingdom",])[1]`).

```{r, echo=FALSE, fig.cap="Survey responses by country"}
gender<-aggregate(Location ~ gender, survey, length)

country_work<-aggregate(gender ~ Country_work, survey, length)

 locations<-aggregate(gender ~ Country, survey.what, length)
ggplot(country_work, aes(x = reorder(Country_work, -gender), gender)) + geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  theme(axis.text.x=element_blank()) + labs(y="Number of responses", x="")  + 
  geom_text(aes(label=gender), vjust=-0.25, hjust=0.25) +
  geom_text(aes(label=Country_work), angle=90, hjust=-0.5) + lims(y=c(0, 1300)) + theme(legend.title=element_text(size=12), 
                                                                                        legend.text=element_text(size=10), axis.text=element_text(size=14), axis.title=element_text(size=16)) + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
                               

```{r, echo=FALSE, fig.cap="Survey responses by field of research (global and Canada)"}
field<-aggregate(Location ~ field_research, survey.what, length)
g1<-ggplot(field, aes(x = reorder(field_research, -Location), Location, fill=field_research)) + geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  theme(axis.text.x=element_blank()) + labs(y="Number of responses",x="")  + scale_fill_discrete(name="Field of Research") + 
  geom_text(aes(label=Location), vjust=-0.25) + theme(legend.position=c(0.78, 0.7)) + theme(legend.title=element_text(size=12), legend.text=element_text(size=10), axis.text=element_text(size=14), 
                                                                                            axis.title=element_text(size=14)) + guides(fill=guide_legend(reverse=TRUE)) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())


canada<-subset(survey.what, Country=="Canada")
field<-aggregate(Location ~ field_research, canada, length)
g2<-ggplot(field, aes(x = reorder(field_research, -Location), Location, fill=field_research)) + geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  theme(axis.text.x=element_blank()) + labs(y="Number of responses",x="")  + scale_fill_discrete(name="Field of Research") +
  geom_text(aes(label=Location), vjust=-0.25) + theme(legend.position=c(0.85, 0.75)) + theme(legend.title=element_text(size=12), 
                                                                                            legend.text=element_text(size=10), axis.text=element_text(size=14), axis.title=element_text(size=16))+ 
  guides(fill=guide_legend(reverse=TRUE)) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())


grid.arrange(g1, g2)

```{r, echo=FALSE, fig.cap="Survey responses by years of experience (global and Canada)"}
experience<-aggregate(Location ~ what_participant_group, survey.what, length)

g3<-ggplot(experience, aes(x = reorder(what_participant_group, -Location), Location, fill=what_participant_group)) + geom_bar(stat='identity',position = position_dodge(width=0.5)) +
  labs(y="Number of responses", x="") +  theme(legend.position="bottom") + theme(axis.text.x=element_blank()) + 
  geom_text(aes(label=Location),size=4, vjust=-0.25) + guides(fill=guide_legend(title=NULL, reverse=TRUE, nrow=6)) + scale_fill_discrete(name="Participant Group") + 
  theme(legend.title=element_text(size=12), legend.text=element_text(size=10), axis.text=element_text(size=14), 
        axis.title=element_text(size=14))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) 

canada<-subset(survey.what, Country=="Canada")

experience<-aggregate(Location ~ what_participant_group, canada, length)

g4<-ggplot(experience, aes(x = reorder(what_participant_group, -Location), Location, fill=what_participant_group)) + geom_bar(stat='identity',position = position_dodge(width=0.5)) +
  labs(y="Number of responses", x="") +  theme(legend.position="bottom") + theme(axis.text.x=element_blank()) + 
  geom_text(aes(label=Location),size=4, vjust=-0.25)+ guides(fill=guide_legend(title=NULL, reverse=TRUE, nrow=6)) + scale_fill_discrete(name="Participant Group") + 
  theme(legend.title=element_text(size=12), legend.text=element_text(size=10), axis.text=element_text(size=14), axis.title=element_text(size=16))+ 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

grid.arrange(g3, g4)

```

### GYA surveys: Canada

#### Part 1 - Type of Research Conducted
```{r, echo=FALSE, fig.cap="Current vs. past research type (Canada)"}

## make sure that Use-inspired is the middle level in the legend

research.wo.total<-subset(research, type%in%c("percent_fundemental_research_current",  "percent_Applied_Research_current" , "percent_Use_inspired_Research_current"))
research.wo.total$percent<-as.numeric(as.character(research.wo.total$percent))
type.avg<-aggregate(percent~ type + Country, research.wo.total, mean)

canada<-subset(research, Country=="Canada")

g1<-ggplot(research.wo.total, aes(type, percent, fill=type)) + geom_boxplot()



research.wo.past.total<-subset(research.past, type_past%in%c("percent_Applied_Research_past",  "percent_Fundamental_Research_past" , "percent_Use_inspired_Research_past"))
type.avg.past<-aggregate(percent_past~ type_past + Country, research.wo.past.total, mean)

canada<-subset(research.change, Country=="Canada")

g2<-ggplot(research.wo.past.total, aes(type_past, percent_past, fill=type_past)) + geom_boxplot()


grid.arrange(g1, g2)
```

```{r, echo=FALSE, fig.cap="Reason for change in research over past 10 years (Canada)"}
## order bars from highest to lowest

# Change in the past 10 years? (yes, no, can't comment)
yes.no<-subset(research.change, select=c("Location","Country",  "gender", "changed_10yrs"))
canada<-subset(yes.no, Country=="Canada")
canada.yesno<-aggregate(Country~ changed_10yrs, canada, length)
canada.yesno<-canada.yesno[!canada.yesno$changed_10yrs=="",]

g1<-ggplot(data=canada.yesno, aes(x=changed_10yrs, y=Country, fill=Country))+ geom_bar(stat='identity') + guides(fill=FALSE)

# What is your main reason for change?
reason<-subset(research.change, select=c("Location","Country",  "gender", "Main_reason_change_interest_related", 
                                         "Main_reason_change_Career_related", "Main_reason_change_Funding_related","Main_reason_change_Socially_related",
                                         "Main_reason_change_Other"))

canada<-subset(reason, Country=="Canada")

## switch to long format
require(tidyr)
canada.long<-gather(canada, reason.change.ca, yes.ca, -Location, -gender, -Country)

## using table to count cases of each category
sum.canada<-data.frame(table(canada.long$reason.change.ca, canada.long$yes.ca))

# remove non-response
sum.canada<-sum.canada[!sum.canada$Var1=="",]

g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+ 
  theme(axis.text.x = element_text(angle=90, vjust=0.5)) +guides(fill=FALSE)




grid.arrange(g1, g2, nrow=1)
```


#### Part 4 - Funding Trends

```{r, echo=FALSE, fig.cap="Perceived importance of fundamental research to Canada"}
## order bars from very important (left) to can't comment (right)
important<-subset(part4, select=c("Location","Country", "gender","opinion_fundamental_important"))

canada<-subset(important, Country=="Canada")
## using table to count cases of each category
sum.important<-data.frame(table(canada$opinion_fundamental_important))
# remove non-response
sum.important<-sum.important[!sum.important$Var1=="",]

ggplot(data=sum.important, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+ 
  theme(axis.text.x = element_text(angle=90, vjust=0.5))

```


```{r, echo=FALSE, fig.cap="Perceived change in research priority by Canadian government"}
## order bars into applied > use > fundamental > no change
priority<-subset(part4, select=c("Location","Country", "gender", "high_priority_fundamental", "high_priority_use_inspired", "high_priority_applied", 
                                 "high_priority_no_change"))
canada<-subset(priority, Country=="Canada")
## switch to long format
require(tidyr)
priority.long<-gather(canada, what.type, higher.priority, -Location, -gender, -Country)

high.priority<-aggregate(higher.priority~ what.type, priority.long, sum)

ggplot(data=high.priority, aes(x=what.type, higher.priority, fill=what.type)) + geom_bar(stat='identity') +  
  theme(axis.text.x = element_text(angle=90, vjust=0.5))
```


```{r, echo=FALSE, fig.cap="Anticipated change in research funding in next 5 years "}
## change in funding on the x-axis, and colours = type of research
## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
availiability.change<-subset(part4, select=c("Location", "Country", "gender", "available_funding_fundamental",  
                                             "available_funding_use_inspired", "available_funding_applied"))
canada<-subset(availiability.change, Country=="Canada")

## switch to long format
require(tidyr)
availiability.change.long.ca<-gather(canada, what.type, level, -Location, -gender, -Country)
availiability.ca<-aggregate(gender~what.type+level, 
                         availiability.change.long.ca,length)
# remove non-response
availiability.ca<-availiability.ca[!availiability.ca$level=="",]

ggplot(data=availiability.ca, aes(x=what.type, gender, fill=level))+ geom_bar(stat='identity') +  
  theme(axis.text.x = element_text(angle=90, vjust=0.5))


```


```{r, echo=FALSE, fig.cap="Effect of change in research funding on research careers of next generation"}

## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
next.generation<-subset(part4, select=c("Location", "Country", "gender","next_generation"))
# remove non-response
next.generation<-next.generation[!next.generation$next_generation=="",]
canada<-subset(next.generation, Country=="Canada")

impact<-aggregate(gender~ next_generation, canada, length)

ggplot(data=impact, aes(x=next_generation, gender, fill=next_generation)) + geom_bar(stat='identity') +  
  theme(axis.text.x = element_text(angle=90, vjust=0.5))


```



ADD GENDER TO PLOTS.....