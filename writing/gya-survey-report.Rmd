---
title: "GYA surveys"
author: "James Robinson; Kristina Tietjen"
date: "28 July 2016"
output:
  html_document: default
  fig_width: 18
  fig_height: 4
  pdf_document: null
---


Intro -
explain the difference between applied, use inspired and fundamental research..... 
insert photo of Pasteur's quadrant - likely in the Intro chapter of the overall report. 

**Methods**
In addition the official data presented in earlier chapters, we also developed and ran a quantitative online survey to query Canadian researchers about their perceptions of, and experiences with, funding for fundamental research. The survey gathered information about gender, discipline, career stage and year PhD was obtained for each researcher, along with detailed information oabout....  An important aim of the survey was to provide an understanding "of trends and central issues relevant to careers in science in a glboal context" 

The online survey was open from the end of May through early August 2016. To disseminate the survey to Canadian researchers, we gathered email addresses from university websites for as many faculty members as possible and emailed them directly. The survey was also shared broadly on social media, through the Global Young Academy network, on scientific list serves, and through personal connections.

**Results**
In total, 1242 Canadian researchers completed the online survey. KT: INSERT SENTENCE ABOUT GENDER Eg. X per cent of survey respondents were male and X per cent female. Almost half of the responses came from either the natural or physical sciences (49%; Figure 2). The remaining responses were spread amongst the medical and life sciences (17%), engineering (11%), interdisciplinary science and social science or humanities). KT: THIS DOES NOT ADD UP TO 100% - did many people not list their discipline?? Over half of the respondents were early career academic researchers, defined as those researchers with less than ten years expereince applying for research grants since completion of their PhD. Another one quarter were senior academic researchers. KT: Again this does not add up to 100% - what is going on?

Overall, respondents reported that 70% of their 




**NOTES ON FIGURES:**
PLEASE REMOVE THE GLOBAL FIGURES THROUGHOUT - THIS IS ONLY THE CANADA REPORT. MOVE GLOBAL FIGURES INTO A DIFFERENT FILE.
FIGURE 1. REMOVE.
FIGURE 2. ADD CATEGORY FOR 'UNKNOWN' OR 'NOT STATED'.
FIGURE 3. PLEASE ORDER IN ORDER OF CAREER I.E. POSTDOC THEN EARLY CAREER THEN SENIOR ACADEMIC, THEN PUT THE TWO NON-ACADEMICS TO THE RIGHT.
FIGURE 4. I think this needs to be 3 frequency histogram plots since respondents reported percentages 

```{r, echo=FALSE, hide=TRUE, warning=FALSE, message=FALSE}
## load in survey data
## CHANGE WORKING DIRECTORY FOR YOUR LOCAL MACHINE BEFORE KNITTING ##
#setwd("/Users/kristinatietjen/Documents/git_hub/gya-research")
setwd("/Users/IMAC3/Documents/git-jpwrobinson/gya-research")

survey.all<-read.csv("data/July 29-126pm-Hamilton.csv", header=TRUE)
survey<-read.csv(file="data/gya-without-incomplete.csv")
survey.what<-read.csv(file="data/gya-country-responses.csv")
research<-read.csv(file="data/gya-surveys-cleaned-research.csv")
#research.past<-read.csv(file="data/gya-surveys-cleaned-research-past.csv")
research.change<-read.csv(file="data/gya-change-reason.csv")
part4<-read.csv(file="data/gya-survey-part4.csv")
part2.b.a<-read.csv(file="data/gya-part2.before.after.csv")
part2.change<-read.csv(file="data/gya-part2.change.csv")
part2.reason<-read.csv(file="data/gya-part2.reason.csv")
part2.view<-read.csv(file="data/gya-part2.view.csv")
part1.view<-read.csv(file="data/gya-part1.view.csv")
part3.change<-read.csv(file="data/gya-part3.change.csv")
part3.grants.long<-read.csv(file="data/gya-part3.grants.long.csv")
part3.success.long<-read.csv(file="data/gya-part3.success.long.csv")
part3.prac.long<-read.csv(file="data/gya-part3.prac.long.csv")
part3.part.long<-read.csv(file="data/gya-part3.part.long.csv")
p3_master.long<-read.csv(file="data/gya-p3_master.long.csv")

## load required packages
require(gridExtra); require(tidyr); require(ggplot2); require(stringr);require(RColorBrewer); require(colorRamps); require(plotrix); require(plyr)

theme_set(theme_bw())

gender<-aggregate(Location ~ gender, survey, length)
country_work<-aggregate(gender ~ Country_work, survey, length)
locations<-aggregate(gender ~ Country, survey.what, length)

```

### Summary statistics



```{r, echo=FALSE, fig.cap="Survey responses by field of research", warning=FALSE, fig.width=14}
field.can<-with(survey.what[survey.what$Country=="Canada",],data.frame(table(field_research))) 
field.can<-field.can[!field.can$field_research=="",]
field.can$field_research<-reorder(field.can$field_research, field.can$Freq)
field.can$field_research<-revalue(field.can$field_research, c("Physical Science (eg. math, physics, chemistry, computer science)" = "Physical Science"))


## setting colour scale to keep colours identical between similar plots
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[-c(1)]
names(myColors) <- levels(field.can$field_research)
colScale <- scale_fill_manual(name = "field_research",values = myColors)


ggplot(field.can, aes(x = reorder(field_research, -Freq), Freq, fill=field_research)) + 
    geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  ylim(c(0, 315)) +
  labs(y="No. of responses",x="", title="")  +
  scale_x_discrete(labels=c("Natural\n Science", "Physical\n Science", "Medicine &\n Life Science", "Engineering", "Interdisciplinary\n Science", "Social Science/\n Humanities", "Other")) +
  geom_text(aes(label=Freq), vjust=-0.25) + 
  theme( axis.text=element_text(size=14),
         axis.text.x=element_text(angle=0, size=14),
         axis.title=element_text(size=14),
         panel.grid.major = element_blank(),
         panel.grid.minor = element_blank()) + 
  guides(fill=FALSE) + colScale





```



```{r, echo=FALSE, fig.cap="Survey responses by years of experience", warning=FALSE, fig.width=14}
## setting colour scale to keep colours identical between similar plots
#myColors <- brewer.pal(6,"Set1")
survey.what<-droplevels(survey.what)
can.field<-survey.what[survey.what$Country=="Canada",]

experience_can<-data.frame(table(survey.what$what_participant_group))
experience_can<-experience_can[!experience_can$Var1=="",]
experience_can<-droplevels(experience_can)

experience_can$Var1<-revalue(experience_can$Var1, c("Early career academic researcher with <10 years experience applying for research grants since completion of PhD" = "Early career academic researcher", "Non-academic researcher conducting or managing research in industry or government with >10 years of experience" = "Non-academic research > 10 yrs experience",
                               "Non-academic researcher conducting or managing research in industry or government with <10 years of experience" = "Non-academic researcher < 10 yrs experience", "Postdoctoral fellow or research assistant with experience applying for research grants, or anticipating the need to apply for grants in the near future" = "Postdoc or RA", "Senior academic researcher with >10 years of experience applying for research grants" = "Senior academic researcher"))
experience_can$Var1<-reorder(experience_can$Var1, experience_can$Freq)

# assign colour scale
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[-c(1:2)]
names(myColors)<- levels(experience_can$Var1)
colScale <- scale_fill_manual(name = "Var1",values = myColors)




ggplot(experience_can, aes(x = reorder(Var1, -Freq), Freq, fill=Var1)) + 
  geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  geom_text(aes(label=Freq, vjust=-1))+
  scale_x_discrete(labels=c("Senior academic researcher", "Early career academic researcher", "Postdoc or RA", "Non-academic research\n > 10 yrs experience", "Non-academic researcher\n < 10 yrs experience")) +
  labs(y="No. of responses", x="") +
  guides(fill=guide_legend(title=NULL, reverse=TRUE, nrow=3)) +  
  theme(legend.title=element_blank(), 
        legend.text=element_text(size=10), 
        axis.text=element_text(size=14),
        axis.text.x=element_text(angle=0, size=12), 
        axis.title=element_text(size=15),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()) + 
  colScale+ ylim(c(0, 1300)) + guides(fill=FALSE)



```

### GYA surveys: Canada

#### Part 1 - Type of Research Conducted
```{r, echo=FALSE, fig.cap="Current vs. past research type", message=FALSE, warning=FALSE, fig.width=14}

## make sure that Use-inspired is the middle level in the legend
res.plot<-subset(research, type%in%c("percent_fundemental_research_current",  "percent_Applied_Research_current" , "percent_Use_inspired_Research_current","percent_Applied_Research_past",  "percent_Fundamental_Research_past" , "percent_Use_inspired_Research_past"))

res.plot$percent<-str_replace_all(res.plot$percent, "%", "")
res.plot$percent<-as.numeric(as.character(res.plot$percent))
res.plot$type<-as.character(res.plot$type)

# add time variable
res.plot$time<-ifelse(grepl( "current", res.plot$type),"Current", "Past")
res.plot$type[res.plot$type=="percent_Applied_Research_past"]<-"Applied"
res.plot$type[res.plot$type=="percent_Applied_Research_current"]<-"Applied"
res.plot$type[res.plot$type=="percent_Fundamental_Research_past"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_fundemental_research_current"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_past"]<-"Use inspired"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_current"]<-"Use inspired"

# change order of the levels
res.plot$time<-as.factor(res.plot$time)
res.plot$time<-factor(res.plot$time, levels(res.plot$time)[c(2,1)])

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 5)]
colScale <- scale_fill_manual(name = "time",values = myColors)


ggplot(res.plot[res.plot$Country=="Canada",], aes(percent, fill=time)) +
    geom_histogram(position='dodge', binwidth=10, bins=seq(0, 100, 10))  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="% funding", y="No. responses", title="")+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          legend.position=c(0.8, 0.2)) + 
    facet_wrap(~type, nrow=3) + colScale +
  scale_x_continuous(breaks=seq(0,100,10))

```

```{r, echo=FALSE, fig.cap="Reason for change in research over past 10 years", fig.width=14}
## order bars from highest to lowest

# Change in the past 10 years? (yes, no, can't comment)
yes.no<-subset(research.change, select=c("Location","Country",  "gender", "changed_10yrs"))
canada<-subset(yes.no, Country=="Canada")
canada.yesno<-data.frame(table(canada$changed_10yrs))
canada.yesno<-canada.yesno[!canada.yesno$Var1=="",]
canada.yesno$Var1<-revalue(canada.yesno$Var1, c("Can't comment (new researcher)"="Can't comment"))

canada.yesno$Var1<-factor(canada.yesno$Var1, levels=c("Yes", "No", "Can't comment"))

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 7,5)]
colScale <- scale_fill_manual(name = "Var1",values = myColors)




g1<-ggplot(data=canada.yesno, aes(x=Var1, y=Freq, fill=Var1))+ 
    geom_bar(stat='identity') + 
    guides(fill=FALSE) + 
    labs(x="", y="No. of responses",title="")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) + colScale


## GRAPH PART 2
# What is your main reason for change?
reason<-subset(research.change, select=c("Location","Country",  "gender", "Main_reason_change_interest_related", 
                                         "Main_reason_change_Career_related", "Main_reason_change_Funding_related","Main_reason_change_Socially_related",
                                         "Main_reason_change_Other"))

canada<-subset(reason, Country=="Canada")

## switch to long format
require(tidyr)
canada.long<-gather(canada, reason.change.ca, yes.ca, -Location, -gender, -Country)

## using table to count cases of each category
sum.canada<-data.frame(table(canada.long$reason.change.ca, canada.long$yes.ca))
sum.canada$Var1<-revalue(sum.canada$Var1, c("Main_reason_change_Career_related" = "Career", "Main_reason_change_Funding_related" = "Funding", "Main_reason_change_interest_related" = "Interest", "Main_reason_change_Other" = "Other", "Main_reason_change_Socially_related"  = "Social"))
sum.canada$Var1<-reorder(sum.canada$Var1, -sum.canada$Freq)

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 8,7,6,5)]
colScale <- scale_fill_manual(name = "Var1",values = myColors)



g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + 
    geom_bar(stat='identity')+  guides(fill=FALSE) +
    theme(axis.text.x = element_text(angle=0, vjust=0.5),
          legend.position=c(0.8, 0.8), 
          legend.title=element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank()) + 
  labs(x="", y="", title="")+
  colScale




grid.arrange(g1, g2, nrow=1)
```

```{r, echo=FALSE, fig.cap="View of change in research over past 10 years (Canada)"}

canada<-subset(part1.view, Country=="Canada")
canada<-canada[!canada$view_change_of_type=="",]

change.view.ca<-aggregate(gender~ view_change_of_type, canada, length)

# change order of the levels
change.view.ca$view_change_of_type<-factor(change.view.ca$view_change_of_type, 
                                        levels(change.view.ca$view_change_of_type)[c(6,4,2,3,5)])

ggplot(change.view.ca, aes(x=view_change_of_type, y=gender, fill=view_change_of_type)) + geom_bar(stat='identity')+
  theme(axis.text.x = element_text(angle=90, vjust=0.5)) +guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ labs(x="", y="Number of Responses")


```

#### Part 2 - External Partnerships
```{r, echo=FALSE, fig.cap="Current vs past level of partnership outside of academia (Canada)", warning=FALSE}
b.part<-aggregate(gender~  partnership_outside_before, part2.b.a, length)
colnames(b.part)[1]<-"partnership_outside"
b.part$time<-"Past"
a.part<-aggregate(gender~ partnership_outside, part2.b.a, length)
a.part$time<-"Current"

part<-rbind(a.part, b.part)

# change order of the levels
part$partnership_outside<-as.factor(part$partnership_outside)
part$partnership_outside<-factor(part$partnership_outside, levels(part$partnership_outside)[c(1,4,3,2)])

ggplot() + 
  geom_bar(data=part, aes(x=partnership_outside, y=gender, fill = time), stat='identity', position="dodge") +
  theme(axis.text.x = element_text(angle=90, vjust=0.5))+labs(x="", y="Number of Responses", fill="")+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
  
```

```{r, echo=FALSE, fig.cap="Reason for change over the past 10 years (Canada)", warning=FALSE}
### was there change
canada<-subset(part2.change, Country=="Canada")
change.part.ca<-aggregate(gender~ partnership_change_10yrs, canada, length)

g1<-ggplot(data=change.part.ca, aes(x=partnership_change_10yrs, gender, fill=partnership_change_10yrs))+geom_bar(stat='identity')+
  theme(axis.text.x = element_text(angle=0, vjust=0.5))+labs(title="Change in past 10yrs", x="", y="Number of Responses", fill="")+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ guides(fill=FALSE)+scale_x_discrete(labels=c("Can't comment \n (new researcher)", "No", "Yes"))

### reason
require(tidyr)
reason.pt.long<-gather(part2.reason, change.reason, yes, -Country, -gender, -Location)
sum.reason<-data.frame(table(reason.pt.long$change.reason, reason.pt.long$yes))

g2<-ggplot(data=sum.reason, aes(x=reorder(Var1, -Freq), y=Freq, fill=Var1)) + geom_bar(stat='identity')+ 
  theme(axis.text.x = element_text(angle=90, vjust=0.5)) + guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+labs(title= "Reason for Change", x="", y="Number of Responses")+
  scale_x_discrete(labels=c("Funding Related", "Interest Related", "Career Related", "Socially Related", "Other"))

grid.arrange(g1, g2, nrow=1)
```

```{r, echo=FALSE, fig.cap="View of Change in partnership (Canada)", warning=FALSE}
canada<-subset(part2.view, Country=="Canada")
view<-aggregate(gender~ view_change_partnership, canada, length)
# change order of the levels
view$view_change_partnership<-factor(view$view_change_partnership, levels(view$view_change_partnership)[c(6,4,2,3,5)])

ggplot(data=view, aes(x=view_change_partnership, y=gender, fill=view_change_partnership)) + geom_bar(stat='identity')+ 
  theme(axis.text.x = element_text(angle=0, vjust=0.5)) + guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+labs(x="", y="Number of Responses")
```

#### Part 3 - Grant Application History

```{r, echo=FALSE, fig.cap="Number of external research grant applications (Canada)", warning=FALSE}
canada<-subset(part3.grants.long, Country=="Canada")
canada$type.grant<-as.character(canada$type.grant)


#add time variable
canada$time<-ifelse(grepl("11_15", canada$type.grant), "2011-2015", "2006-2010")
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_applied"]<-"Applied"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_applied"]<-"Applied"

grants.ca<-aggregate(gender~ type.grant+time+number, canada, length)

grants.ca$type.grant<-as.factor(grants.ca$type.grant)

#change order of levels
grants.ca$number<-factor(grants.ca$number, levels(grants.ca$number)[c(1,2,6,7,3,4,5)])
grants.ca$type.grant<-factor(grants.ca$type.grant, levels(grants.ca$type.grant)[c(2,3,1)])

ggplot(grants.ca, aes(type.grant, gender, fill=number)) + geom_bar(stat="identity", position = "dodge")+facet_wrap(~time) +guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
  labs(x="Number of grant applications", y="Number of responses")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())




```

```{r, echo=FALSE, fig.cap="Percentage of research grant application success (Canada)", warning=FALSE}
canada<-subset(part3.success.long, Country=="Canada")

canada$type<-as.character(canada$type)

#add time variable
canada$time<-ifelse(grepl("11_15", canada$type), "2011-2015", "2006-2010")
canada$type[canada$type=="successful_grants_11_15_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_6_10_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_11_15_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_6_10_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_11_15_applied"]<-"Applied"
canada$type[canada$type=="successful_grants_6_10_applied"]<-"Applied"

success.ca<-aggregate(gender~type+percent+time, canada, length)

#change order of types
success.ca$type<-as.factor(success.ca$type)
success.ca$type<-factor(success.ca$type, levels(success.ca$type)[c(2,3,1)])


ggplot(success.ca, aes(percent, gender, fill=time))+geom_bar(stat="identity", position = "dodge")+facet_wrap(~type)+
  guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
  labs(x="Percent of success", y="Number of responses")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

```

```{r, echo=FALSE, fig.cap="Importance of suggesting practical applications of the research for the grant to be successful (Canada)", warning=FALSE}
canada<-subset(part3.prac.long, Country=="Canada")

canada$year<-as.character(canada$year)

canada$year[canada$year=="practical_applications_important_11_15"]<-"2011-2015"
canada$year[canada$year=="practical_applications_important_6_10"]<-"2006-2010"

prac.ca<-aggregate(gender~year+level, canada, length)

#change order of levels
prac.ca$level<-factor(prac.ca$level, levels(prac.ca$level)[c(2,6,4,5,3,1)])


ggplot(prac.ca, aes(level, gender, fill=year))+ geom_bar(stat="identity", position = "dodge")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(fill=guide_legend(title=NULL, reverse=FALSE)) + labs(x="", y="Number of responses")+theme(axis.text.x = element_text(angle=90, vjust=0.5)) 

```

```{r, echo=FALSE, fig.cap="Importance of including partners from for-profit or non-governmental sectors in grant success (Canada)", warning=FALSE}
canada<-subset(part3.part.long, Country=="Canada")

canada$year<-as.character(canada$year)

canada$year[canada$year=="practical_applications_important_11_15"]<-"2011-2015"
canada$year[canada$year=="practical_applications_important_6_10"]<-"2006-2010"

part.ca<-aggregate(gender~year+level, canada, length)

#change order of levels
part.ca$level<-factor(part.ca$level, levels(part.ca$level)[c(2,5,6,4,3,1)])


ggplot(part.ca, aes(level, gender, fill=year))+ geom_bar(stat="identity", position = "dodge")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  guides(fill=guide_legend(title=NULL, reverse=FALSE)) + labs(x="", y="Number of responses")+theme(axis.text.x = element_text(angle=90, vjust=0.5)) 

```

```{r, echo=FALSE, fig.cap="Distribution of research funding (Canada)", warning=FALSE}
canada<-subset(p3_master.long, Country=="Canada")

ggplot(canada, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=25)  +  facet_wrap(~type)

```


```{r, echo=FALSE, fig.cap="Grant success rates change over the past 10 years (Canada)", warning=FALSE}
canada<-subset(part3.change, Country=="Canada")
require(tidyr)
##switch to long format
change.long.ca<-gather(canada, type, level, -Location, -gender, -Country)

gender.change<-aggregate(Location~type+gender+level, change.long.ca, length)

#remove no response
gender.change<-gender.change[!gender.change$gender=="",]
gender.change<-gender.change[!gender.change$level=="",]

# turn to percents
male<-subset(gender.change, gender=="Male")
female<-subset(gender.change, gender=="Female")
other<-subset(gender.change, gender=="Other")
gender.change$Location<-ifelse(gender.change$gender=="Male", (gender.change$Location/sum(male$Location))*100, gender.change$Location)
gender.change$Location<-ifelse(gender.change$gender=="Female", (gender.change$Location/sum(female$Location))*100, gender.change$Location)
gender.change$Location<-ifelse(gender.change$gender=="Other", (gender.change$Location/sum(other$Location))*100, gender.change$Location)

# change type to factor with levels
gender.change$type<-as.factor(gender.change$type)
gender.change$level<-str_replace_all(gender.change$level, "Will", "")
gender.change$level<-as.factor(gender.change$level)

#change order of levels
gender.change$level<-factor(gender.change$level, levels(gender.change$level)[c(1,3,2,6,4,5)])
gender.change$type<-factor(gender.change$type, levels(gender.change$type)[c(2,3,1)])

ggplot(data=gender.change, aes(x=level, Location, fill=type))+geom_bar(stat="identity", position="dodge")+ scale_x_discrete(limits = rev(levels(gender.change$level)))+
  facet_wrap(~gender)+theme(axis.text.x = element_text(angle=90, vjust=0.5))+labs(x="", y="Percentage of responses", fill="")+
  scale_fill_discrete(labels=c("Fundamental", "Use-inspired", "Applied")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

```



#### Part 4 - Funding Trends

```{r, echo=FALSE, fig.cap="Perceived importance of fundamental research to Canada \n need to elabrate here but waiting to see if significant tests for gender, career, and stage return anything"}
## order bars from very important (left) to can't comment (right)
important<-subset(part4, select=c("Location","Country", "gender","opinion_fundamental_important"))

canada<-subset(important, Country=="Canada")
## using table to count cases of each category
sum.important<-data.frame(table(canada$opinion_fundamental_important, canada$gender))
# remove non-responses
sum.important<-sum.important[!sum.important$Var2=="",]
sum.important<-sum.important[!sum.important$Var1=="",]

perceive<-aggregate(Freq~Var1, sum.important, sum)

#gender.perceive<-aggregate(Freq ~ Var2 + Var1, sum.important, sum)
# turn to percents
#male<-subset(gender.perceive, Var2=="Male")
#female<-subset(gender.perceive, Var2=="Female")
#other<-subset(gender.perceive, Var2=="Other")
#gender.perceive$Freq<-ifelse(gender.perceive$Var2=='Male',(gender.perceive$Freq/sum(male$Freq))*100, gender.perceive$Freq)
#gender.perceive$Freq<-ifelse(gender.perceive$Var2=='Female',(gender.perceive$Freq/sum(female$Freq))*100, gender.perceive$Freq)
#gender.perceive$Freq<-ifelse(gender.perceive$Var2=='Other',(gender.perceive$Freq/sum(other$Freq))*100, gender.perceive$Freq)


ggplot(data=perceive, aes(x=Var1, y=Freq)) + geom_bar(stat='identity', position='dodge')+ labs(x="", y="No. of responses", fill="")+theme(axis.text.x = element_text(angle=45, vjust=0.4))+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+scale_x_discrete(limits = rev(levels(perceive$Var1)))+geom_text(aes(label=Freq), vjust=-0.5)

```


```{r, echo=FALSE, fig.cap="Perceived change in research priority by Canadian government \n need to elabrate here but waiting to see if significant tests for gender, career, and stage return anything"}
## order bars into applied > use > fundamental > no change
priority<-subset(part4, select=c("Location","Country", "gender", "high_priority_fundamental", "high_priority_use_inspired", "high_priority_applied", 
                                 "high_priority_no_change"))
canada<-subset(priority, Country=="Canada")
## switch to long format
require(tidyr)
priority.long<-gather(canada, what.type, higher.priority, -Location, -gender, -Country)
# remove non-responses
priority.long<-priority.long[!priority.long$gender=="",]

per.change<-aggregate(higher.priority~what.type, priority.long, sum)

#gender.perceive<-aggregate(higher.priority ~ gender + what.type, priority.long, sum)
# turn to percents
#male<-subset(gender.perceive, gender=="Male")
#female<-subset(gender.perceive, gender=="Female")
#other<-subset(gender.perceive, gender=="Other")
#gender.perceive$higher.priority<-ifelse(gender.perceive$gender=='Male',(gender.perceive$higher.priority/sum(male$higher.priority))*100, #gender.perceive$higher.priority)
#gender.perceive$higher.priority<-ifelse(gender.perceive$gender=='Female',(gender.perceive$higher.priority/sum(female$higher.priority))*100, #gender.perceive$higher.priority)
#gender.perceive$higher.priority<-ifelse(gender.perceive$gender=='Other',(gender.perceive$higher.priority/sum(other$higher.priority))*100, #gender.perceive$higher.priority)

# change order of the levels
per.change$what.type<-as.factor(per.change$what.type)
per.change$what.type<-factor(per.change$what.type, levels(per.change$what.type)[c(2,4,1,3)])


ggplot(data=per.change, aes(x=what.type, higher.priority))+geom_bar(stat="identity", position='dodge')+ theme(axis.text.x = element_text()) +labs(x="", y="No. of responses", fill="") +theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ scale_x_discrete(labels=c( "Fundamental", "Use-inspired","Applied", "No change"))+theme(axis.text.x = element_text(angle=45, vjust=0.4))+geom_text(aes(label=higher.priority), vjust=-0.5)


```


```{r, echo=FALSE, fig.cap="Anticipated change in research funding in next 5 years in Canada \n need to elabrate here but waiting to see if significant tests for gender, career, and stage return anything "}
## change in funding on the x-axis, and colours = type of research
## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
availability.change<-subset(part4, select=c("Location", "Country", "gender", "available_funding_fundamental",  
                                             "available_funding_use_inspired", "available_funding_applied"))
canada<-subset(availability.change, Country=="Canada")
## switch to long format
require(tidyr)
availability.change.long.ca<-gather(canada, what.type, level, -gender, -Location, -Country)

availiability.ca<-aggregate(gender~what.type+level, availability.change.long.ca, length)

#remove non response
availiability.ca<-availiability.ca[!availiability.ca$level=="",]

#gender.perceive<-aggregate(Location ~ what.type + gender+level, availability.change.long.ca, length)

#availability.ca<-aggregate(gender~what.type+level, availability.change.long.ca,length)
# remove non-response
#gender.perceive<-gender.perceive[!gender.perceive$level=="",]
#gender.perceive<-gender.perceive[!gender.perceive$gender=="",]

# turn to percents
#male<-subset(gender.perceive, gender=="Male")
#female<-subset(gender.perceive, gender=="Female")
#other<-subset(gender.perceive, gender=="Other")
#gender.perceive$Location<-ifelse(gender.perceive$gender=='Male',(gender.perceive$Location/sum(male$Location))*100, gender.perceive$Location)
#gender.perceive$Location<-ifelse(gender.perceive$gender=='Female',(gender.perceive$Location/sum(female$Location))*100, gender.perceive$Location)
#gender.perceive$Location<-ifelse(gender.perceive$gender=='Other',(gender.perceive$Location/sum(other$Location))*100, gender.perceive$Location)

## change type to factor with levels
availiability.ca$level<-str_replace_all(availiability.ca$level, "Will ", "")
availiability.ca$what.type<-as.factor(availiability.ca$what.type)
availiability.ca$level<-as.factor(availiability.ca$level)

## change order of levels
availiability.ca$level<-factor(availiability.ca$level, levels(availiability.ca$level)[c(4,5,6,3,2,1 )])
availiability.ca$what.type<-factor(availiability.ca$what.type, levels(availiability.ca$what.type)[c(2,3,1)])


ggplot(data=availiability.ca, aes(x=what.type, gender, fill=level))+geom_bar(stat="identity", position="dodge")+theme(axis.text.x = element_text(angle=45, vjust=0.5))+labs(x="", y="No. of responses", fill="")+scale_fill_discrete(labels=c("Increase Considerably", "Increase Slightly", "Stay the Same", "Decrease Slightly", "Decrease Considerably", "Can't Comment"))+scale_x_discrete(labels=c("Fundamental", "Use-inspired", "Applied"))+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

                                                                                                                                                                                                                                                                                                                                                                                                                    
```


```{r, echo=FALSE, fig.cap="Effect of change in research funding on research careers of next generation in Canada \n need to elabrate here but waiting to see if significant tests for gender, career, and stage return anything"}

## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
next.generation<-subset(part4, select=c("Location", "Country", "gender","next_generation"))
# remove non-response
next.generation<-next.generation[!next.generation$next_generation=="",]
canada<-subset(next.generation, Country=="Canada")

impact<-aggregate(gender~ next_generation, canada, length)

## change type to factor with levels
impact$next_generation<-str_replace_all(impact$next_generation, "Will ", "")
impact$next_generation<-as.factor(impact$next_generation)
## change order of next_generations
impact$next_generation<-factor(impact$next_generation, factor(impact$next_generation)[c(2,3,6,5,4,1 )])


ggplot(data=impact, aes(x=next_generation, gender, fill=next_generation))+ geom_bar(stat='identity', position="dodge") + scale_x_discrete(labels=c("Decrease Considerably","Decrease Slightly","Stay the Same","Increase Slightly","Increase Considerably", "Can't Comment")) + guides(fill=FALSE) +
 labs(x="", y="No. of responses")+theme(axis.text.x = element_text(angle=45, vjust=0.5))+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())



```
