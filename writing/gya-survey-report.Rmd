---
title: "GYA surveys"
author: "James Robinson; Kristina Tietjen"
date: "28 July 2016"
output:
  pdf_document: null
  fig_width: 18
  html_document: default
  fig_height: 4
---


Intro -
explain the difference between applied, use inspired and fundamental research..... 
insert photo of Pasteur's quadrant - likely in the Intro chapter of the overall report. 

**Methods**
In addition to the official data presented in earlier chapters, we also developed and ran a quantitative online survey to query Canadian researchers about their perceptions of, and experiences with, funding for fundamental research. The survey first gathered basic information from each respondent about gender, discipline, career stage and the year their PhD was obtained, before moving on to detailed information about the types of research they conduct (fundamental, use-inspired, applied), their grant success rates, the extent of external partnerships in their research, and how each of these factors have changed over time. In addition, the survey asked respondents how important they perceive fundamental research is to the Canadian federal government, and future prospects for fundamental research in Canada. An important aim of the survey was to provide an understanding researcher's personal experiences and outlook on the research funding landscape in  Canada. 

The online survey was open from the end of May through early August 2016. To disseminate the survey to Canadian researchers, we gathered email addresses from university websites for as many faculty members as possible and emailed them directly. The survey also was shared broadly on social media, through the Global Young Academy network, on scientific list serves, and through personal connections.

```
### -- Note: We defined 'Canadian' respondents as those who reported 'Canada' as their country of work AND those who did not report a country of work (i.e. field was blank) but their location was within Canada. 
```
  
**Results**
In total, 1283 Canadian researchers completed the online survey. Of these, almost three quarters were male (74%) and one quarter were female (25%); a very small proportion either did not input their gender or selected other. Almost all of the survey respondents (94%) were either senior academics (66%), defined as those researchers with more than ten years experience applying for research grants since completion of their PhD, or early career academics (29%) (Figure 1). 
 <! --- 
Female 318 / 1283; Male 946/1283
ECR: 367 / 1283; Non-academic ECR: 7; Non-academic >10yrs: 15; Post-doc: 48; Senior: 841 (65.5%); 5 no responses; 
Engineering 163 (12.7%); Inter 70 (5.48%); Med/Life Sci 251(19.65%); Natural 377 (29.5%); Other 3; Phys 382 (29.9%); Social 37. For some unknown reason this totals 1277; 
 -->
 
Sixty per cent of responses came from either the natural or physical sciences (Figure 2). The remaining responses were spread amongst the medical and life sciences (20%), engineering (13%), interdisciplinary research (5%), and social sciences and humanities (3%). 

*Research Type* SOMEHOW HAVE TO MAKE SENSE OF THE RESPONSES AND PLOT FOR THE % OF RESEARCH IN THE THREE CATEGORIES. Almost one third of researchers reported that the types of research they conduct has shifted over the past ten years (Figure 3). By far, the most reported reason for this change was funding (Figure 4). This suggests.....  However, opinions about these changes were varible, with one quarter of respondents viewing them as slightly negative, one quarter slightly positive and one quarter very positive (Figure X). 

*External Partnerships* The extent to which research is conducted with partners outside of academia, including in industry and non-governmental sectors, may also be considered as an indicator of use-inspired or applied research. Almost all respondents reported that their current research is conducted with some external partners, with X% reporting some partnership and X and Y% reporting strong or exclusive partnerships, respectively. In contrast, X% of researchers said that in the past they had no external partners in their research, whereas that number today was much lower..... 

Again, the predominate reason given was funding related (Figure X).

However, very few researchers viewed this change as being very negative. Most researchers regarded it as either slightly negative or slightly positive, and X% viewed it as very positive. 

*Research Grants* 
[STILL TO COME]

The majority of respondents believe that it is now either mandatory or very important to suggest practical applications of their research in order for their grant applications to be successful. This has shifted over time, with researchers reporting that between 2006 and 2010 it was only somewhat important to do so (Figure X).

Similarly...... including partners from for-profit or non-governmental sectors in grants to be successful (Figure X).

*Perspectives on the State of Fundamental Research in Canada*
Over half of Canadian researchers who responded said that fundamental research is either very important or somewhat important to our government. Differences by career stage, discipline,ggender....

At the same time, almost three-quarters of respondents said that applied research became a higher priority for our government over the past decade. 

Summarize finding on how they think availabiltiy of research funding will change over the next five years: 
  



```{r, echo=FALSE, hide=TRUE, warning=FALSE, message=FALSE}
## load in survey data
## CHANGE WORKING DIRECTORY FOR YOUR LOCAL MACHINE BEFORE KNITTING ##
#setwd("/Users/kristinatietjen/Documents/git_hub/gya-research")
setwd("/Users/IMAC3/Documents/git-jpwrobinson/gya-research")
#setwd("/Users/jpwrobinson/Documents/git_repos/gya-research")
#setwd("/Users/Julia_2013MacBookAir/Desktop/GitRepos/gya-research")

survey.all<-read.csv("data/July 29-126pm-Hamilton.csv", header=TRUE)
survey<-read.csv(file="data/gya-without-incomplete.csv")
survey.what<-read.csv(file="data/gya-country-responses.csv")
research<-read.csv(file="data/gya-surveys-cleaned-research.csv")
#research.past<-read.csv(file="data/gya-surveys-cleaned-research-past.csv")
research.change<-read.csv(file="data/gya-change-reason.csv")
part4<-read.csv(file="data/gya-survey-part4.csv")
part2.b.a<-read.csv(file="data/gya-part2.before.after.csv")
part2.change<-read.csv(file="data/gya-part2.change.csv")
part2.reason<-read.csv(file="data/gya-part2.reason.csv")
part2.view<-read.csv(file="data/gya-part2.view.csv")
part1.view<-read.csv(file="data/gya-part1.view.csv")
part3.change<-read.csv(file="data/gya-part3.change.csv")
part3.grants.long<-read.csv(file="data/gya-part3.grants.long.csv")
part3.success.long<-read.csv(file="data/gya-part3.success.long.csv")
part3.prac.long<-read.csv(file="data/gya-part3.prac.long.csv")
part3.part.long<-read.csv(file="data/gya-part3.part.long.csv")
p3_master.long<-read.csv(file="data/gya-p3_master.long.csv")

## load required packages
require(gridExtra); require(tidyr); require(ggplot2); require(stringr);require(RColorBrewer); require(colorRamps); require(plotrix); require(plyr)

theme_set(theme_bw())

#gender<-aggregate(Location ~ gender, survey, length)
#country_work<-aggregate(gender ~ Country_work, survey, length)
#locations<-aggregate(gender ~ Country, survey.what, length)

```

### Summary statistics

```{r, echo=FALSE, fig.cap="Survey responses by field of research", warning=FALSE, fig.width=14}
#field.can<-with(survey.what[survey.what$Country=="Canada",],data.frame(table(field_research))) 
field.can<-with(survey.what[survey.what$Country_work=="Canada" | (!(survey.what$Country_work=="Canada") & survey.what$Country_work=="" & survey.what$Country=="Canada"),], data.frame(table(field_research)))
field.can<-field.can[!field.can$field_research=="",]
field.can$field_research<-reorder(field.can$field_research, field.can$Freq)
field.can$field_research<-revalue(field.can$field_research, c("Physical Science (eg. math, physics, chemistry, computer science)" = "Physical Science"))


## setting colour scale to keep colours identical between similar plots
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[-c(1)]
names(myColors) <- levels(field.can$field_research)
colScale <- scale_fill_manual(name = "field_research",values = myColors)


ggplot(field.can, aes(x = reorder(field_research, -Freq), Freq, fill=field_research)) + 
    geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  ylim(c(0, 400)) +
  labs(y="No. of responses",x="", title="")  +
  scale_x_discrete(labels=c("Natural\n Science", "Physical\n Science", "Medicine &\n Life Science", "Engineering", "Interdisciplinary\n Science", "Social Science/\n Humanities", "Other")) +
  geom_text(aes(label=Freq), vjust=-0.25) + 
  theme( axis.text=element_text(size=14),
         axis.text.x=element_text(angle=0, size=14),
         axis.title=element_text(size=14),
         panel.grid.major = element_blank(),
         panel.grid.minor = element_blank()) + 
  guides(fill=FALSE) + colScale





```

```{r, echo=FALSE, fig.cap="Survey responses by participant group", warning=FALSE, fig.width=14}
## setting colour scale to keep colours identical between similar plots
#myColors <- brewer.pal(6,"Set1")
survey.what<-droplevels(survey.what)
#can.field<-survey.what[survey.what$Country=="Canada",]
can.field<-survey.what[survey.what$Country_work=="Canada" | (!(survey.what$Country_work=="Canada") & survey.what$Country_work=="" & survey.what$Country=="Canada"),]

experience_can<-data.frame(table(survey.what$what_participant_group))
experience_can<-experience_can[!experience_can$Var1=="",]
experience_can<-droplevels(experience_can)

experience_can$Var1<-revalue(experience_can$Var1, c("Early career academic researcher with <10 years experience applying for research grants since completion of PhD" = "Early career academic researcher", "Non-academic researcher conducting or managing research in industry or government with >10 years of experience" = "Non-academic research > 10 yrs experience",
                               "Non-academic researcher conducting or managing research in industry or government with <10 years of experience" = "Non-academic researcher < 10 yrs experience", "Postdoctoral fellow or research assistant with experience applying for research grants, or anticipating the need to apply for grants in the near future" = "Postdoc or RA", "Senior academic researcher with >10 years of experience applying for research grants" = "Senior academic researcher"))
experience_can$Var1<-reorder(experience_can$Var1, experience_can$Freq)

# assign colour scale
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[-c(1:2)]
names(myColors)<- levels(experience_can$Var1)
colScale <- scale_fill_manual(name = "Var1",values = myColors)

ggplot(experience_can, aes(x = reorder(Var1, -Freq), Freq, fill=Var1)) + 
  geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  geom_text(aes(label=Freq, vjust=-1))+
  scale_x_discrete(labels=c("Senior academic researcher", "Early career academic researcher", "Postdoc or RA", "Non-academic research\n > 10 yrs experience", "Non-academic researcher\n < 10 yrs experience")) +
  labs(y="No. of responses", x="") +
  guides(fill=guide_legend(title=NULL, reverse=TRUE, nrow=3)) +  
  theme(legend.title=element_blank(), 
        legend.text=element_text(size=10), 
        axis.text=element_text(size=14),
        axis.text.x=element_text(angle=0, size=12), 
        axis.title=element_text(size=15),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()) + 
  colScale+ ylim(c(0, 1300)) + guides(fill=FALSE)



```

### GYA surveys: Canada

#### Part 1 - Type of Research Conducted
```{r, echo=FALSE, fig.cap="Funding allocation to fundamental, use-inspired and applied research categories. Reseachers were questioned about the percentage of funding allocated to Fundamental, Use-inspired or Applied research in the past and in their current research.", message=FALSE, warning=FALSE, fig.width=10}

## make sure that Use-inspired is the middle level in the legend
res.plot<-subset(research, type%in%c("percent_fundemental_research_current",  "percent_Applied_Research_current" , "percent_Use_inspired_Research_current","percent_Applied_Research_past",  "percent_Fundamental_Research_past" , "percent_Use_inspired_Research_past"))

res.plot$percent<-str_replace_all(res.plot$percent, "%", "")
res.plot$percent<-as.numeric(as.character(res.plot$percent))
res.plot$type<-as.character(res.plot$type)

# add time variable
res.plot$time<-ifelse(grepl( "current", res.plot$type),"Current", "Past")
res.plot$type[res.plot$type=="percent_Applied_Research_past"]<-"Applied"
res.plot$type[res.plot$type=="percent_Applied_Research_current"]<-"Applied"
res.plot$type[res.plot$type=="percent_Fundamental_Research_past"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_fundemental_research_current"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_past"]<-"Use-inspired"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_current"]<-"Use-inspired"

# change order of the levels
res.plot$time<-as.factor(res.plot$time)
res.plot$time<-factor(res.plot$time, levels(res.plot$time)[c(2,1)])

res.plot$type<-as.factor(res.plot$type)
res.plot$type<-factor(res.plot$type, levels(res.plot$type)[c(2,3,1)])

res.plot$time<-factor(res.plot$time)
res.plot$time<-factor(res.plot$time, levels(res.plot$time)[c(1,2)])

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(5,9)]
colScale <- scale_fill_manual(name = "time",values = myColors)

res.plot<-res.plot[res.plot$Country_work=="Canada" | (!(res.plot$Country_work=="Canada") & res.plot$Country_work=="" & res.plot$Country=="Canada"),]

ggplot(res.plot, aes(percent, fill=time)) +
    geom_histogram(position='dodge', binwidth=10, bins=seq(0, 100, 10))  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="% funding", y="No. responses", title="")+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.8, 0.2)) + 
    facet_wrap(~type, nrow=3) + colScale +
  scale_x_continuous(breaks=seq(0,100,10))

```

```{r, echo=FALSE, fig.cap="Reason for change in research over past 10 years. Researchers were asked if their funding proportions had changed in the past ten years (a), and what the main reason for a change in their research category (b).", fig.width=14}
## order bars from highest to lowest

# Change in the past 10 years? (yes, no, can't comment)
yes.no<-subset(research.change, select=c("Location","Country",'Country_work', "gender", "changed_10yrs"))
canada<-yes.no[yes.no$Country_work=="Canada" | (!(yes.no$Country_work=="Canada") & yes.no$Country_work=="" & yes.no$Country=="Canada"),]
canada.yesno<-data.frame(table(canada$changed_10yrs))
canada.yesno<-canada.yesno[!canada.yesno$Var1=="",]
canada.yesno$Var1<-revalue(canada.yesno$Var1, c("Can't comment (new researcher)"="Can't comment"))

canada.yesno$Var1<-factor(canada.yesno$Var1, levels=c("Yes", "No", "Can't comment"))

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 7,5)]
colScale <- scale_fill_manual(name = "Var1",values = myColors)

g1<-ggplot(data=canada.yesno, aes(x=Var1, y=Freq, fill=Var1))+ 
    geom_bar(stat='identity') + 
    guides(fill=FALSE) + 
    labs(x="", y="No. of responses",title="")+
   annotate('text', 3.25,635, label="(a)", size=7)+
  geom_text(aes(label=Freq), vjust=-0.5)+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) + colScale


## GRAPH PART 2
# What is your main reason for change?
reason<-subset(research.change, select=c("Location","Country","Country_work",  "gender", "Main_reason_change_interest_related", 
                                         "Main_reason_change_Career_related", "Main_reason_change_Funding_related","Main_reason_change_Socially_related",
                                         "Main_reason_change_Other"))

canada<-reason[reason$Country_work=="Canada" | (!(reason$Country_work=="Canada") & reason$Country_work=="" & reason$Country=="Canada"),]
## switch to long format
canada.long<-gather(canada, reason.change.ca, yes.ca, -Location, -gender, -Country,-Country_work)

## using table to count cases of each category
sum.canada<-data.frame(table(canada.long$reason.change.ca, canada.long$yes.ca))
sum.canada$Var1<-revalue(sum.canada$Var1, c("Main_reason_change_Career_related" = "Career", "Main_reason_change_Funding_related" = "Funding", "Main_reason_change_interest_related" = "Interest", "Main_reason_change_Other" = "Other", "Main_reason_change_Socially_related"  = "Social"))
sum.canada$Var1<-reorder(sum.canada$Var1, -sum.canada$Freq)

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 8,7,6,5)]
colScale <- scale_fill_manual(name = "Var1",values = myColors)



g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + 
    geom_bar(stat='identity')+  guides(fill=FALSE) +
    theme(axis.text.x = element_text(angle=0, vjust=0.5),
          legend.position=c(0.8, 0.8), 
          legend.title=element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank()) + 
   annotate('text', 5,415, label="(b)", size=7)+ ylim(c(0, 415))+
  geom_text(aes(label=Freq), vjust=-0.5)+
  labs(x="", y="", title="")+
  colScale

grid.arrange(g1, g2, nrow=1)
```

```{r, echo=FALSE, fig.cap="Opinion of change in research over past 10 years. Researchers were asked how they viewed the change in research type."}

#canada<-subset(part1.view, Country=="Canada")
canada<-part1.view[part1.view$Country_work=="Canada" | (!(part1.view$Country_work=="Canada") & part1.view$Country_work=="" & part1.view$Country=="Canada"),]
canada<-canada[!canada$view_change_of_type=="",]

change.view.ca<-data.frame(table(canada$view_change_of_type))
change.view.ca<-change.view.ca[!change.view.ca$Var1=="",]
change.view.ca$Var1<-droplevels(change.view.ca$Var1)
# change order of the levels
change.view.ca$Var1<-factor(change.view.ca$Var1, 
                                        levels(change.view.ca$Var1)[c(5,3,1,2,4)])


myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(7,7,7,7,7)])
colScale <- scale_fill_manual(name = "Var1",values = myColors)



ggplot(change.view.ca, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+
  geom_text(aes(label=Freq, vjust=-0.5))+
  guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle=0, vjust=0.5)) + 
  labs(x="", y="No. of Responses") + colScale


```

#### Part 2 - External Partnerships
```{r, echo=FALSE, fig.cap="Current vs past level of partnership outside of academia. Researchers indicated the level of partnership that their research had outside of academia, for 10 years ago (past) and for their current research (current).", warning=FALSE}
part2.b.a<-part2.b.a[part2.b.a$Country_work=="Canada" | (!(part2.b.a$Country_work=="Canada") & part2.b.a$Country_work=="" & part2.b.a$Country=="Canada"),]

b.part<-data.frame(table(part2.b.a$partnership_outside_before))
b.part$time<-"Past"
a.part<-data.frame(table(part2.b.a$partnership_outside))
a.part$time<-"Current"

part<-rbind(a.part, b.part)
part$Var1<-factor(part$Var1, levels(part$Var1)[c(1,4,3,2)])
part$time<-factor(part$time)
part$time<-factor(part$time, levels(part$time)[c(2,1)])

myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 6)])
colScale <- scale_fill_manual(name = "Var1",values = myColors)

ggplot(part, aes(x=Var1, y=Freq, fill = time)) + 
  geom_bar( stat='identity', position="dodge") +
  geom_text(aes(label=Freq), position=position_dodge(width=1), vjust=-0.8) +
  labs(x="", y="No. of Responses", fill="")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle=0), 
        legend.position=c(0.2, 0.9), 
        legend.title=element_blank()) +
  colScale
  
```

```{r, echo=FALSE, fig.cap="Reasons for change in external partnerships over the past 10 years. Researchers were asked if their level of external partnerships outside of academia, with for-profit or non-governmental sectors, had changed over the past ten years (a) and what the reason for that change was (b).", warning=FALSE}
### was there change
#canada<-subset(part2.change, Country=="Canada")
canada<-part2.change[part2.change$Country_work=="Canada" | (!(part2.change$Country_work=="Canada") & part2.change$Country_work=="" & part2.change$Country=="Canada"),]


change.part.ca<-data.frame(table(canada$partnership_change_10yrs))
change.part.ca$Var1<-revalue(change.part.ca$Var1, c("Can't comment (new researcher)"="Can't comment"))

change.part.ca$Var1<-factor(change.part.ca$Var1, levels=c("Yes", "No", "Can't comment"))

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 7,5)]


g1<-ggplot(data=change.part.ca, aes(x=Var1, y=Freq, fill=Var1))+ 
    geom_bar(stat='identity') + 
    guides(fill=FALSE) + 
    labs(x="", y="No. of responses",title="")+
  geom_text(aes(label=Freq), vjust=-0.5)+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) + 
  scale_fill_manual(name = "Var1",values = myColors) +
  annotate('text', 3.25,606, label="(a)", size=7)

### reason
part2.reason<-part2.reason[part2.reason$Country_work=="Canada" | (!(part2.reason$Country_work=="Canada") & part2.reason$Country_work=="" & part2.reason$Country=="Canada"),]
reason.pt.long<-gather(part2.reason, change.reason, yes, -Country,-Country_work, -gender, -Location)
sum.canada<-data.frame(table(reason.pt.long$change.reason, reason.pt.long$yes))

sum.canada$Var1<-revalue(sum.canada$Var1, c("reason_partnership_change_career" = "Career", "reason_partnership_change_funding" = "Funding", "reason_partnership_change_interest" = "Interest", "reason_partnership_change_other" = "Other", "reason_partnership_change_socially"  = "Social"))
sum.canada$Var1<-reorder(sum.canada$Var1, -sum.canada$Freq)

myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 8,7,6,5,3)]


g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + 
    geom_bar(stat='identity')+  guides(fill=FALSE) +
    theme(axis.text.x = element_text(angle=0, vjust=0.5),
          legend.position=c(0.8, 0.8), 
          legend.title=element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank()) + 
  geom_text(aes(label=Freq), vjust=-0.5)+
  annotate('text', 5,420, label="(b)", size=7)+ ylim(c(0, 420))+
  labs(x="", y="", title="")+scale_fill_manual(name = "Var1",values = myColors)
  


grid.arrange(g1, g2, nrow=1)
```

```{r, echo=FALSE, fig.cap="View of change in external partnerships. Researchers were asked how they viewed the change in the level of partnership with external groups.", warning=FALSE}
#canada<-subset(part2.view, Country=="Canada")
canada<-part2.view[part2.view$Country_work=="Canada" | (!(part2.view$Country_work=="Canada") & part2.view$Country_work=="" & part2.view$Country=="Canada"),]
view<-data.frame(table(canada$view_change_partnership))
# change order of the levels

view$Var1<-factor(view$Var1, levels(view$Var1)[c(5,3,1,2,4)])


ggplot(view, aes(x=Var1, y=Freq, fill=myColors[1])) + geom_bar(stat='identity')+
  geom_text(aes(label=Freq, vjust=-0.5))+
  guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle=0, vjust=0)) + 
  labs(x="", y="No. of Responses") + colScale

```

#### Part 3 - Grant Application History

```{r, echo=FALSE, fig.cap="Number of research grant applications by research category in 2006-2010 and 2011-2015.", warning=FALSE, fig.height=12}
#canada<-subset(part3.grants.long, Country=="Canada")
canada<-part3.grants.long[part3.grants.long$Country_work=="Canada" | (!(part3.grants.long$Country_work=="Canada") & part3.grants.long$Country_work=="" & part3.grants.long$Country=="Canada"),]
canada$type.grant<-as.character(canada$type.grant)


#add time variable
canada$time<-ifelse(grepl("11_15", canada$type.grant), "2011-2015", "2006-2010")
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_applied"]<-"Applied"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_applied"]<-"Applied"

grants.ca<-data.frame(with(canada, table(type.grant,time,number)))
grants.ca$type.grant<-as.factor(grants.ca$type.grant)


#change order of levels
grants.ca$number<-factor(grants.ca$number, levels(grants.ca$number)[c(1,2,6,7,3,4,5)])
grants.ca$type.grant<-factor(grants.ca$type.grant, levels(grants.ca$type.grant)[c(2,3,1)])

myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "time",values = myColors)


ggplot(grants.ca, aes(number, Freq, fill=time)) + 
    geom_bar(stat="identity", position = "dodge")+
    facet_wrap(~type.grant, nrow=3) +
    guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
    labs(x="No. of grant applications", y="No. of responses")+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
           strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.8, 0.2)) + colScale




```

```{r, echo=FALSE, fig.cap="Research grant application success over the past 10 years. Researchers were asked to estimate the percentage of their research grant applications that were successful, in 2006-2010 and in 2011-2015.", warning=FALSE}
#canada<-subset(part3.success.long, Country=="Canada")
canada<-part3.success.long[part3.success.long$Country_work=="Canada" | (!(part3.success.long$Country_work=="Canada") & part3.success.long$Country_work=="" & part3.success.long$Country=="Canada"),]
canada$type<-as.character(canada$type)

#add time variable
#canada$time<-ifelse(grepl("11_15", canada$type), "2011-2015", "2006-2010")
canada$type[canada$type=="successful_grants_11_15_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_6_10_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_11_15_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_6_10_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_11_15_applied"]<-"Applied"
canada$type[canada$type=="successful_grants_6_10_applied"]<-"Applied"

success.ca<-data.frame(with(canada, table(type, percent,time)))

#change order of types
success.ca$type<-as.factor(success.ca$type)
success.ca$type<-factor(success.ca$type, levels(success.ca$type)[c(2,3,1)])

myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "time",values = myColors)


ggplot(success.ca, aes(percent, Freq, fill=time)) + 
    geom_bar(stat="identity", position = "dodge")+
    facet_wrap(~type, nrow=3) +
    guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
    labs(x="% successful grants", y="No. of responses")+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
           strip.text.y = element_text(size=14, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.8, 0.2)) + colScale

```

```{r, echo=FALSE, fig.cap="Importance of practical application of research over the past 10 years. Researchers were asked how important it was to suggest practical applications of their research to ensure that the grant was successful, in 2006-2010 and in 2011-2015.", warning=FALSE}

canada<-part3.prac.long[part3.prac.long$Country_work=="Canada" | (!(part3.prac.long$Country_work=="Canada") & part3.prac.long$Country_work=="" & part3.prac.long$Country=="Canada"),]

canada$year<-as.character(canada$year)

canada$year[canada$year=="practical_applications_important_11_15"]<-"2011-2015"
canada$year[canada$year=="practical_applications_important_6_10"]<-"2006-2010"


prac.ca<-data.frame(table(canada$year, canada$level))

#change order of levels
prac.ca$Var2<-factor(prac.ca$Var2, levels(prac.ca$Var2)[c(2,6,4,5,3,1)])

myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors)


ggplot(prac.ca, aes(Var2, Freq, fill=Var1)) + 
  geom_bar(stat="identity", position = "dodge")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.position=c(0.8, 0.8),
        axis.text.x = element_text(angle=0, vjust=0.5)) +
  guides(fill=guide_legend(title=NULL, reverse=FALSE)) + 
  scale_x_discrete(labels=c("Mandatory", "Quite\n important", 'Somewhat\n important',"Not at all\n important", 'Not at all\n important', "Can't\n comment"))+
  labs(x="", y="No. of responses")+ colScale
  

```

```{r, echo=FALSE, fig.cap="Importance of including partners from for-profit or non-governmental sectors in grant success. Researchers were asked how important it was to include external partnerships in their research to ensure that the grant was successful, in 2006-2010 and in 2011-2015.", warning=FALSE}

canada<-part3.part.long[part3.part.long$Country_work=="Canada" | (!(part3.part.long$Country_work=="Canada") & part3.part.long$Country_work=="" & part3.part.long$Country=="Canada"),]

canada$year<-as.character(canada$year)

canada$year[canada$year=="practical_applications_important_11_15"]<-"2011-2015"
canada$year[canada$year=="practical_applications_important_6_10"]<-"2006-2010"

part.ca<-data.frame(table(canada$year, canada$level))

#change order of levels
part.ca$Var2<-factor(part.ca$Var2, levels(part.ca$Var2)[c(2,5,6,4,3,1)])

## add colour scale
myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors)


ggplot(part.ca, aes(Var2, Freq, fill=Var1))+ 
  geom_bar(stat="identity", position = "dodge")+
    guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
    labs(x="", y="No. of responses")+
  scale_x_discrete(labels=c("Mandatory", "Quite\n important", 'Somewhat\n important',"Not at all\n important", 'Not at all\n important', "Can't\n comment"))+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          legend.position=c(0.8, 0.8)) + colScale
```

```{r, echo=FALSE, fig.cap="Distribution of research funding over the past 10 years. Researchers were asked to estimate the distribution of their research funding sources in 2006-2010 and 2011-2015.", warning=FALSE,fig.height=12}

canada<-p3_master.long[p3_master.long$Country_work=="Canada" | (!(p3_master.long$Country_work=="Canada") & p3_master.long$Country_work=="" & p3_master.long$Country=="Canada"),]

canada$year<-revalue(c("11_15"="2011-2015", "6_10"="2006-2010"))


myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "year",values = myColors)

ggplot(canada, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=25)  + 
  facet_wrap(~type, nrow=5) + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.9, 0.08),
          strip.text.y = element_text(size=14, face="bold", color="black"),
          legend.key.size = unit(0.3, "cm"),
          strip.background = element_rect(colour="white", fill="white")) +
  labs(x="% research funding", y = "No. of respondents")

```


```{r, echo=FALSE, fig.cap="Change in grant success rates over the past 10 years. Researchers were asked if they thought that grant sucecss rates have changed in the past 10 years, for each research category.", warning=FALSE}
canada<-part3.change[part3.change$Country_work=="Canada" | (!(part3.change$Country_work=="Canada") & part3.change$Country_work=="" & part3.change$Country=="Canada"),]


##switch to long format
change.long.ca<-gather(canada, type, level, -Location, -gender, -Country, -Country_work)

gender.change<-with(change.long.ca, data.frame(table(type, level)))

#remove no response
#dim(gender.change[!gender.change$level=="",])
## 18 no responses
gender.change<-gender.change[!gender.change$level=="",]

# turn to percents
#male<-subset(gender.change, gender=="Male")
#female<-subset(gender.change, gender=="Female")
#other<-subset(gender.change, gender=="Other")
#gender.change$Location<-ifelse(gender.change$gender=="Male", (gender.change$Location/sum(male$Location))*100, gender.change$Location)
#gender.change$Location<-ifelse(gender.change$gender=="Female", (gender.change$Location/sum(female$Location))*100, gender.change$Location)
#gender.change$Location<-ifelse(gender.change$gender=="Other", (gender.change$Location/sum(other$Location))*100, gender.change$Location)

# change type to factor with levels
gender.change$type<-as.factor(gender.change$type)
gender.change$level<-str_replace_all(gender.change$level, "Will", "")
gender.change$level<-as.factor(gender.change$level)

# add colour palette
myColors<-(brewer.pal(9, "Blues"))
myColors<-(myColors[c(9, 6, 3)])
colScale <- scale_fill_manual(name = "type",values = myColors, labels=c("Fundamental", "Use-inspired", "Applied"))



#change order of levels
gender.change$level<-factor(gender.change$level, levels(gender.change$level)[c(1,3,2,6,4,5)])
gender.change$type<-factor(gender.change$type, levels(gender.change$type)[c(2,1,3)])
gender.change$type<-revalue(gender.change$type, c("success_change_10yrs_fundamental"="Fundamental",
              'success_change_10yrs_use'='Use-inspired', 'success_change_10yrs_applied' = 'Applied'))

ggplot(data=gender.change, aes(x=level, Freq, fill=type))+
  geom_bar(stat="identity", position="dodge")+ 
  guides(fill=guide_legend(title=NULL)) +
  theme(axis.text.x = element_text(angle=0, vjust=0.5),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
         strip.text.y = element_text(size=14, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
        legend.position=c(0.15, 0.9))+ 
  facet_wrap(~type, nrow=3) +
  guides(fill=FALSE)+
  geom_text(aes(label=Freq, vjust=-0.5),size=3) +
  scale_x_discrete(labels=c("Increase\n considerably", "Increase\n slightly", 
                                    "Stay the same", "Decrease\n slightly", "Decrease\n considerably", "Can't\n comment"),limits = (levels(gender.change$level)))+
  labs(x="", y="No. of responses", fill="")+ colScale + ylim(c(0, 600))

```



#### Part 4 - Funding Trends

```{r, echo=FALSE, fig.cap="Perceived importance of fundamental research to Canadian government. Researchers were asked how important they thought fundamental research was to the Canadian government. Responses were/were not significantly different between genders."}
## order bars from very important (left) to can't comment (right)
important<-subset(part4, select=c("Location","Country",'Country_work', "gender","opinion_fundamental_important"))

canada<-important[important$Country_work=="Canada" | (!(important$Country_work=="Canada") & important$Country_work=="" & important$Country=="Canada"),]

## using table to count cases of each category
sum.important<-data.frame(table(canada$opinion_fundamental_important, canada$gender))
# remove non-responses
sum.important<-sum.important[!sum.important$Var2=="",]
sum.important<-sum.important[!sum.important$Var1=="",]
sum.important$Var1<-factor(sum.important$Var1, levels(sum.important$Var1)[c(6,5,4,3,2,1)])

perceive<-aggregate(Freq~Var1, sum.important, sum)


### colour palette

myColors<-(brewer.pal(9, "Blues"))
myColors<-(myColors[c(9, 7, 6, 4, 2)])
colScale <- scale_fill_manual(name = "Var1",values = myColors)


#gender.perceive<-aggregate(Freq ~ Var2 + Var1, sum.important, sum)
# turn to percents
#male<-subset(gender.perceive, Var2=="Male")
#female<-subset(gender.perceive, Var2=="Female")
#other<-subset(gender.perceive, Var2=="Other")
#gender.perceive$Freq<-ifelse(gender.perceive$Var2=='Male',(gender.perceive$Freq/sum(male$Freq))*100, gender.perceive$Freq)
#gender.perceive$Freq<-ifelse(gender.perceive$Var2=='Female',(gender.perceive$Freq/sum(female$Freq))*100, gender.perceive$Freq)
#gender.perceive$Freq<-ifelse(gender.perceive$Var2=='Other',(gender.perceive$Freq/sum(other$Freq))*100, gender.perceive$Freq)


ggplot(data=perceive, aes(x=Var1, y=Freq)) + 
      geom_bar(stat='identity', position='dodge',fill=myColors[2])+ 
      labs(x="", y="No. of responses", fill="")+
      scale_x_discrete(labels=c("Very\n important", "Somewhat\n important", 'Not very\n important', 'Not at all\n important', "Can't\n comment"))+
      geom_text(aes(label=Freq), vjust=-0.5) +
      theme(axis.text.x = element_text(angle=0, vjust=0.4),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank()) 
    


```


```{r, echo=FALSE, fig.cap="Perceived change in research priority by Canadian government. Researchers were asked whether any types of research had become higher priority for the Canadian government. Responses were/were not significantly different between genders."}
## order bars into applied > use > fundamental > no change
priority<-subset(part4, select=c("Location","Country",'Country_work', "gender", "high_priority_fundamental", "high_priority_use_inspired", "high_priority_applied", 
                                 "high_priority_no_change"))

canada<-priority[priority$Country_work=="Canada" | (!(priority$Country_work=="Canada") & priority$Country_work=="" & priority$Country=="Canada"),]


## switch to long format

priority.long<-gather(canada, what.type, higher.priority, -Location, -gender, -Country, -Country_work)
# remove non-responses (n = 1066)
#dim(priority.long[!priority.long$higher.priority=="",])/4

priority.long<-priority.long[!priority.long$higher.priority=="",]

per.change<-aggregate(higher.priority~what.type, priority.long, sum)

#gender.perceive<-aggregate(higher.priority ~ gender + what.type, priority.long, sum)
# turn to percents
#male<-subset(gender.perceive, gender=="Male")
#female<-subset(gender.perceive, gender=="Female")
#other<-subset(gender.perceive, gender=="Other")
#gender.perceive$higher.priority<-ifelse(gender.perceive$gender=='Male',(gender.perceive$higher.priority/sum(male$higher.priority))*100, #gender.perceive$higher.priority)
#gender.perceive$higher.priority<-ifelse(gender.perceive$gender=='Female',(gender.perceive$higher.priority/sum(female$higher.priority))*100, #gender.perceive$higher.priority)
#gender.perceive$higher.priority<-ifelse(gender.perceive$gender=='Other',(gender.perceive$higher.priority/sum(other$higher.priority))*100, #gender.perceive$higher.priority)

# change order of the levels
per.change$what.type<-as.factor(per.change$what.type)
per.change$what.type<-factor(per.change$what.type, levels(per.change$what.type)[c(2,4,1,3)])


ggplot(data=per.change, aes(x=what.type, higher.priority))+
        geom_bar(stat="identity", position='dodge', fill=myColors[2])+ 
        theme(axis.text.x = element_text(),
              axis.text.x = element_text(angle=45, vjust=0.4),
              panel.grid.major = element_blank(),
              panel.grid.minor = element_blank()) +
        labs(x="", y="No. of responses", fill="") +
  scale_x_discrete(labels=c( "Fundamental", "Use-inspired","Applied", "No change"))   +
  geom_text(aes(label=higher.priority), vjust=-0.5)


```


```{r, echo=FALSE, fig.cap="Anticipated change in research funding in next five years in Canada. Researchers were asked whether the availability of research funding would change in the next five years, for each research category. Responses were/were not significantly different between genders. "}
## change in funding on the x-axis, and colours = type of research
## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
availability.change<-subset(part4, select=c("Location", "Country",'Country_work', "gender", "available_funding_fundamental",  
                                             "available_funding_use_inspired", "available_funding_applied"))

canada<-availability.change[availability.change$Country_work=="Canada" | (!(availability.change$Country_work=="Canada") & availability.change$Country_work=="" & availability.change$Country=="Canada"),]

## switch to long format

availability.change.long.ca<-gather(canada, what.type, level, -gender, -Location, -Country, -Country_work)
availability.ca<-with(availability.change.long.ca, data.frame(table(what.type, level)))

#remove non response
availability.ca<-availability.ca[!availability.ca$level=="",]

#gender.perceive<-aggregate(Location ~ what.type + gender+level, availability.change.long.ca, length)

#availability.ca<-aggregate(gender~what.type+level, availability.change.long.ca,length)
# remove non-response
#gender.perceive<-gender.perceive[!gender.perceive$level=="",]
#gender.perceive<-gender.perceive[!gender.perceive$gender=="",]

# turn to percents
#male<-subset(gender.perceive, gender=="Male")
#female<-subset(gender.perceive, gender=="Female")
#other<-subset(gender.perceive, gender=="Other")
#gender.perceive$Location<-ifelse(gender.perceive$gender=='Male',(gender.perceive$Location/sum(male$Location))*100, gender.perceive$Location)
#gender.perceive$Location<-ifelse(gender.perceive$gender=='Female',(gender.perceive$Location/sum(female$Location))*100, gender.perceive$Location)
#gender.perceive$Location<-ifelse(gender.perceive$gender=='Other',(gender.perceive$Location/sum(other$Location))*100, gender.perceive$Location)

## change type to factor with levels
availability.ca$level<-str_replace_all(availability.ca$level, "Will ", "")
availability.ca$what.type<-as.factor(availability.ca$what.type)
availability.ca$level<-as.factor(availability.ca$level)

## change order of levels
availability.ca$level<-factor(availability.ca$level, levels(availability.ca$level)[c(4,5,6,3,2,1 )])
availability.ca$what.type<-factor(availability.ca$what.type, levels(availability.ca$what.type)[c(2,3,1)])

availability.ca$what.type<-revalue(availability.ca$what.type, c("available_funding_fundamental"="Fundamental",
              'available_funding_use_inspired'='Use-inspired', 'available_funding_applied' = 'Applied'))

### colour palette

myColors<-(brewer.pal(9, "Blues"))
myColors<-(myColors[c(9, 6,3)])
colScale <- scale_fill_manual(name = "what.type",values = myColors)


ggplot(data=availability.ca, aes(x=level, Freq, fill=what.type))+
    geom_bar(stat="identity", position="dodge")+
    theme(axis.text.x = element_text(angle=0, vjust=0.5),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
           strip.text.y = element_text(size=14, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.8, 0.2))+
    guides(fill=FALSE)+
    labs(x="", y="No. of responses", fill="")+
    scale_x_discrete(labels=c("Increase\n considerably", "Increase\n slightly", 
                                    "Stay the same", "Decrease\n slightly", "Decrease\n considerably", "Can't\n comment"))+
    facet_wrap(~what.type,nrow=3)+
    geom_text(aes(label=Freq), vjust=-0.5, size=3) + colScale +ylim(c(0, 550))

                                                                                                                                                                                                                                                                                                                   
```


```{r, echo=FALSE, fig.cap="Effect of change in research funding on research careers of next generation in Canada. Researchers were asked if they though that changes in funding availability would influence the likelihood of the next generation pursuing careers in research. Responses were/were not significantly different between genders."}

## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
next.generation<-subset(part4, select=c("Location", "Country","Country_work", "gender","next_generation"))
# remove non-response
next.generation<-next.generation[!next.generation$next_generation=="",]
canada<-next.generation[next.generation$Country_work=="Canada" | (!(next.generation$Country_work=="Canada") & next.generation$Country_work=="" & next.generation$Country=="Canada"),]


impact<-data.frame(table(canada$next_generation))

## change type to factor with levels
impact$Var1<-str_replace_all(impact$Var1, "Will ", "")
impact$Var1<-as.factor(impact$Var1)
impact<-impact[!impact$Var1=="",]
## change order of Var1s
impact$Var1<-factor(impact$Var1, levels(impact$Var1)[c(4,5,6,3,2,1)])
impact<-droplevels(impact)

 
ggplot(data=impact, aes(x=Var1, Freq))+ 
    geom_bar(stat='identity', position="dodge", fill=myColors[2])  +
        scale_x_discrete(labels=c("Increase\n considerably", "Increase\n slightly", 
                                    "Stay the same", "Decrease\n slightly", "Decrease\n considerably", "Can't\n comment"))+
    guides(fill=FALSE) +
 labs(x="", y="No. of responses")+
  theme(axis.text.x = element_text(angle=0, vjust=0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())+
  geom_text(aes(label=Freq), vjust=-0.5)

```
