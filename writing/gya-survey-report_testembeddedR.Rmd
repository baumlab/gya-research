---
title: "Canadian online survey on fundamental research"
author: ''
date: "16 September 2016"
output:
  html_document: default
  fig_width: 18
  fig_height: 4
  pdf_document: null
  word_document: default
---

**Introduction**  
In addition to the official data presented in Chapters 2 and 3, we also developed and ran a quantitative online survey to query researchers about their perceptions of, and experiences with, funding for fundamental research. An important aim of the survey was to provide an understanding researcher's personal experiences and outlook on the research funding landscape in Canada. We had an excellent response to the survey, with over 1300 Canadian researchers completing it, suggesting that fundamental research funding is a high priority topic for Canadian researchers. Herein, we detail the survey questions and results. 

**Methods**  
Online Survey  
The survey was open to researchers from all disciplines (e.g. science, social sciences, humanities, engineering, medicine) and career stages, with the proviso that they had some experience applying for research funding. The survey gathered detailed information in four major areas: 1) the types of research the scholars conduct (fundamental, use-inspired, applied), 2) the extent of external partnerships in their research, 3) their grant success rates, and 4) how important they perceive fundamental research is to the Canadian federal government and its future prospects in Canada. The survey also enquired how each of these factors have changed over time for the researchers. Finally, the survey gathered basic information from each respondent about gender, discipline, career stage and the year their PhD was obtained. The full survey is provided in Appendix 2. 

The online survey was open from the end of May through early October 2016, and ran on the Fluid Surveys platform (fluidsurveys.com). Note that the survey was open to researchers from any country in the world because it is was run as part of a global survey through the Global Young Academy. To disseminate the survey to Canadian researchers, we gathered email addresses from Canadian university websites for as many faculty members as possible and emailed individual researchers directly. We also shared the survey broadly on social media, as well as through the Global Young Academy network, on scientific list serves, and through personal connections. 

Survey Data Analysis  
To extract survey responses for Canadian researchers, we selected all respondents who reported 'Canada' as their country of work, as well as those respondents who did not report a country of work (i.e. field was blank) but whose location was within Canada. We conducted all statistical analyses in the open source software R (Version 3.3.1).
**Note that numbers not all the same because respondents did not always answer every question**

<!-- Import Canadian data, calculate sample sizes -->
```{r, echo=FALSE, message=FALSE, hide=TRUE, warning=FALSE, message=FALSE} 
## CHANGE WORKING DIRECTORY FOR YOUR LOCAL MACHINE BEFORE KNITTING ##
setwd("/Users/kristinatietjen/Documents/git_hub/gya-research/writing")
#setwd("/Users/IMAC3/Documents/git-jpwrobinson/gya-research")
#setwd("/Users/jpwrobinson/Documents/git_repos/gya-research")
#setwd("/Users/Julia_2013MacBookAir/Desktop/GitRepos/gya-research/writing")
## load in survey data
survey<-read.csv(file="../data/gya-without-incomplete.csv")
n.Cdn.res <- survey[survey$Country_work=="Canada" | (!(survey$Country_work=="Canada") & 
             survey$Country_work=="" & survey$Country=="Canada"),]  #Count how many responses from Canadian researchers
survey.what<-read.csv(file="../data/gya-country-responses.csv")
research<-read.csv(file="../data/gya-surveys-cleaned-research.csv")
#research.past<-read.csv(file="data/gya-surveys-cleaned-research-past.csv")
research.change<-read.csv(file="../data/gya-change-reason.csv")
part4<-read.csv(file="../data/gya-survey-part4.csv")
part2.b.a<-read.csv(file="../data/gya-part2.before.after.csv")
part2.change<-read.csv(file="../data/gya-part2.change.csv")
part2.reason<-read.csv(file="../data/gya-part2.reason.csv")
part2.view<-read.csv(file="../data/gya-part2.view.csv")
part1.view<-read.csv(file="../data/gya-part1.view.csv")
part3.change<-read.csv(file="../data/gya-part3.change.csv")
part3.grants.long<-read.csv(file="../data/gya-part3.grants.long.csv")
part3.success.long<-read.csv(file="../data/gya-part3.success.long.csv")
part3.prac.long<-read.csv(file="../data/gya-part3.prac.long.csv")
part3.part.long<-read.csv(file="../data/gya-part3.part.long.csv")
p3_master.long<-read.csv(file="../data/gya-p3_master.long.csv")
p3_master <- read.csv(file="../data/gya-p3_master.csv")

#Gender:
n.Cdn.res.men <- n.Cdn.res[n.Cdn.res$gender=="Male",]               #Count how many responses from Canadian male researchers
percent.men<-((dim(n.Cdn.res.men)[1])/(dim(n.Cdn.res)[1]))*100      #Calculate the % of responses from Canadian male researchers
n.Cdn.res.women <- n.Cdn.res[n.Cdn.res$gender=="Female",]           #Count how many responses from Canadian female researchers
percent.women<-((dim(n.Cdn.res.women)[1])/(dim(n.Cdn.res)[1]))*100  #Calculate the % of responses from Canadian female researchers

#Career Stage Tabulations:
#table(n.Cdn.res$what_participant_group)
n.Cdn.seniorac <- n.Cdn.res[n.Cdn.res$what_participant_group=="Senior academic researcher with >10 years of experience applying for research grants",]
percent.seniorac<-((dim(n.Cdn.seniorac)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian senior academic researchers
n.Cdn.earlyac <- n.Cdn.res[n.Cdn.res$what_participant_group=="Early career academic researcher with <10 years experience applying for research grants since completion of PhD",]
percent.earlyac<-((dim(n.Cdn.earlyac)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian early academic researchers
n.Cdn.pdf <- n.Cdn.res[n.Cdn.res$what_participant_group=="Postdoctoral fellow or research assistant with experience applying for research grants, or anticipating the need to apply for grants in the near future",]
percent.pdf<-((dim(n.Cdn.pdf)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian post-docs
n.Cdn.nonACearly <- n.Cdn.res[n.Cdn.res$what_participant_group=="Non-academic researcher conducting or managing research in industry or government with <10 years of experience",]
percent.nonACearly<-((dim(n.Cdn.nonACearly)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from early career non-academics
n.Cdn.nonACsenior <- n.Cdn.res[n.Cdn.res$what_participant_group=="Non-academic researcher conducting or managing research in industry or government with >10 years of experience",]
percent.nonACsenior<-((dim(n.Cdn.nonACsenior)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from early career non-academics
n.Cdn.unk <- n.Cdn.res[n.Cdn.res$what_participant_group=="",]
percent.unk<-((dim(n.Cdn.unk)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from unknown career stage

#Discipline Tabulations:
n.natural <- n.Cdn.res[n.Cdn.res$field_research=="Natural Science",]
percent.natural <- ((dim(n.natural)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian natural scientists
n.physics <- n.Cdn.res[n.Cdn.res$field_research=="Physical Science (eg. math, physics, chemistry, computer science)",]
percent.physics <- ((dim(n.physics)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian physical scientists
n.med <- n.Cdn.res[n.Cdn.res$field_research=="Medicine and Life Science",]
percent.med <- ((dim(n.med)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian med/life scientists
n.eng <- n.Cdn.res[n.Cdn.res$field_research=="Engineering",]
percent.eng <- ((dim(n.eng)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian engineering scientists
n.int <- n.Cdn.res[n.Cdn.res$field_research=="Interdisciplinary Science",]
percent.int <- ((dim(n.int)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian interdisciplinary scientists
n.ssh <- n.Cdn.res[n.Cdn.res$field_research=="Social Science / Humanities",]
percent.ssh <- ((dim(n.ssh)[1])/(dim(n.Cdn.res)[1]))*100 #Calculate the % of responses from Canadian interdisciplinary scientists

```

**Results**  
In total, `r dim(n.Cdn.res)[1]` Canadian researchers completed the online survey. Of these, almost three quarters were male (`r ceiling(percent.men)`%) and one quarter were female (`r round(percent.women)`%); a very small proportion either did not input their gender or selected other. Almost all of the survey respondents (`r round(sum(percent.seniorac,percent.earlyac))`%) were either senior academics (`r round(percent.seniorac)`%), defined as those researchers with more than ten years experience applying for research grants since completion of their PhD, or early career academics (`r round(percent.earlyac)`%) (Figure 4.1). A small proportion of responses also came from post-doctoral researchers (`r round(percent.pdf)`%), non-academic researchers (`r  round(sum(percent.nonACearly,percent.nonACsenior))`%), or those who did not indicate their career stage (`r round(percent.unk, digits=1)`%).

Researchers from many different disciplines were represented in the survey. Almost sixty percent of responses came from either the natural or physical sciences (Figure 4.2). The remaining responses were spread amongst the medical and life sciences (`r round(percent.med)`%), engineering (`r round(percent.eng)`%), interdisciplinary research (`r round(percent.int)`%), and social sciences and humanities (`r round(percent.ssh)`%). 

<!-- Generate Canadian career stage figure -->
```{r, echo=FALSE, message=FALSE, fig.cap="Figure 4.1 Number of Canadian survey respondents by career stage", warning=FALSE, fig.width=14}
## load required packages
require(gridExtra); require(tidyr); require(ggplot2); require(stringr);require(RColorBrewer); require(colorRamps); require(plotrix); require(plyr); require(grid)

theme_set(theme_bw())
## setting colour scale to keep colours identical between similar plots
## myColors <- brewer.pal(6,"Set1")
can.field<-survey.what[survey.what$Country_work=="Canada" | (!(survey.what$Country_work=="Canada") & survey.what$Country_work=="" & survey.what$Country=="Canada"),]

experience_can<-data.frame(table(can.field$what_participant_group))
experience_can<-experience_can[!experience_can$Var1=="",]
experience_can<-droplevels(experience_can)

experience_can$Var1<-revalue(experience_can$Var1, c("Early career academic researcher with <10 years experience applying for research grants since completion of PhD" = "Early career academic researcher", "Non-academic researcher conducting or managing research in industry or government with >10 years of experience" = "Non-academic research > 10 yrs experience", "Non-academic researcher conducting or managing research in industry or government with <10 years of experience" = "Non-academic researcher < 10 yrs experience", "Postdoctoral fellow or research assistant with experience applying for research grants, or anticipating the need to apply for grants in the near future" = "Postdoc or RA", "Senior academic researcher with >10 years of experience applying for research grants" = "Senior academic researcher"))
experience_can$Var1<-reorder(experience_can$Var1, experience_can$Freq)

# assign colour scale
myColors1<-(brewer.pal(9, "Blues"))
myColors1<-myColors1[-c(1:2)]
names(myColors1)<- levels(experience_can$Var1)
colScale <- scale_fill_manual(name = "Var1",values = myColors1)

ggplot(experience_can, aes(x = reorder(Var1, -Freq), Freq, fill=Var1)) + 
  geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  geom_text(aes(label=Freq, vjust=-1), size=3)+
  scale_x_discrete(labels=c("Senior academic", "Early career academic", "Postdoc or RA", "Senior non-academic", "Early career non-academic")) +
  labs(y="Number of responses", x="") +
  guides(fill=guide_legend(title=NULL, reverse=TRUE, nrow=3)) +  
  theme(aspect.ratio=1/2,legend.title=element_blank(), 
        legend.text=element_text(size=10), 
        axis.text.y=element_text(size=9),
        axis.text.x=element_text(angle=0, size=9), 
        axis.title=element_text(size=11),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()) + 
  colScale + guides(fill=FALSE)+
  scale_y_continuous(expand = c(0,0), limits = c(0,910))
```

<!-- Generate Canadian research discipline figure -->
```{r, echo=FALSE, fig.cap="Figure 4.2 Survey responses by field of research", warning=FALSE, fig.width=14}
field.can<-with(survey.what[survey.what$Country_work=="Canada" | (!(survey.what$Country_work=="Canada") & survey.what$Country_work=="" & survey.what$Country=="Canada"),], data.frame(table(field_research)))
field.can<-field.can[!field.can$field_research=="",]
field.can$field_research<-reorder(field.can$field_research, field.can$Freq)
field.can$field_research<-revalue(field.can$field_research, c("Physical Science (eg. math, physics, chemistry, computer science)" = "Physical Science"))

## setting colour scale to keep colours identical between similar plots
myColors2<-(brewer.pal(9, "Blues"))
myColors2<-myColors2[-c(1)]
names(myColors2) <- levels(field.can$field_research)
colScale <- scale_fill_manual(name = "field_research",values = myColors2)

ggplot(field.can, aes(x = reorder(field_research, -Freq), Freq, fill=field_research)) + 
    geom_bar(stat='identity',position = position_dodge(width=0.5)) + 
  labs(y="Number of responses",x="", title="")  +
  scale_x_discrete(labels=c("Natural\n Science", "Physical\n Science", "Medicine &\n Life Science", "Engineering", "Interdisciplinary\n Science", "Social Science/\n Humanities", "Other")) +
  geom_text(aes(label=Freq), vjust=-0.25, size=3) + 
  theme( aspect.ratio=1/2, axis.text.y=element_text(size=9),
         axis.text.x=element_text(angle=0, size=9),
         axis.title=element_text(size=11),
         panel.grid.major = element_blank(),
         panel.grid.minor = element_blank()) + 
  guides(fill=FALSE) + colScale+
  scale_y_continuous(expand = c(0,0), limits = c(0,410))
```

**4.1 Type of Research Conducted**  
Canadian survey respondents included researchers conducting all three types of research: fundamental, use-inspired, and applied. Very few researchers (1.2%) considered themselves to currently do only one type of research: 0.1% applied, 0.3% use-inspired, 0.8% fundamental (Figure 4.3). There was a 11% drop in the number of researchers that only did fundamental research between the two time frames.  This drop could have been caused by funding availability. Over one quarter (29%) of researchers consider that over half of their research program is in fundamental science currently. The number of researchers that consider over half of their research program is in applied science currently is 10% and in use-inspired only 9%.  There should be proportionally more research funding for fundamental science than applied or use-inspired. Limited research funding was most likely the reason why there was a drop in fundamental research and an increase in both use-inspired and applied (researchers that considered 50% or more of their past research fundamental -38%, applied -6%, use-inspired - 6%).

Over one third of researchers (40%) reported that the types of research they conduct has shifted over the past ten years (Figure 4.4). By far, the most reported reason for this change was funding (45%) followed by interest (26%) (Figure 4.4).  However, opinions about these changes were varible, with one quarter of respondents viewing them as slightly negative (25%), one quarter slightly positive (23%) and one quarter very positive (25%) (Figure 4.5).  The positive feelings about these changes may be due to less stress about attaining funding.

<!-- Generate figure showing current and past fundamental, use-inspiried, and applied research %s -->
```{r, echo=FALSE, fig.cap="Figure 4.3 Respondents type of research describe in proportal amounts of fundamental, use-inspired and applied research. Reseachers were questioned about the percentage of funding allocated to Fundamental, Use-inspired or Applied research in the past and in their current research.", message=FALSE, warning=FALSE, fig.width=10}

## make sure that Use-inspired is the middle level in the legend
res.plot<-subset(research, type%in%c("percent_fundemental_research_current",  "percent_Applied_Research_current" , "percent_Use_inspired_Research_current","percent_Applied_Research_past",  "percent_Fundamental_Research_past" , "percent_Use_inspired_Research_past"))

res.plot$percent<-str_replace_all(res.plot$percent, "%", "")
res.plot$percent<-as.numeric(as.character(res.plot$percent))
res.plot$type<-as.character(res.plot$type)

# add time variable
res.plot$time<-ifelse(grepl( "current", res.plot$type),"Current", "Past")
res.plot$type[res.plot$type=="percent_Applied_Research_past"]<-"Applied"
res.plot$type[res.plot$type=="percent_Applied_Research_current"]<-"Applied"
res.plot$type[res.plot$type=="percent_Fundamental_Research_past"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_fundemental_research_current"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_past"]<-"Use-inspired"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_current"]<-"Use-inspired"

# change order of the levels
res.plot$time<-as.factor(res.plot$time)
res.plot$time<-factor(res.plot$time, levels(res.plot$time)[c(2,1)])

res.plot$type<-as.factor(res.plot$type)
res.plot$type<-factor(res.plot$type, levels(res.plot$type)[c(2,3,1)])

res.plot$time<-factor(res.plot$time)
res.plot$time<-factor(res.plot$time, levels(res.plot$time)[c(1,2)])

#myColors<-(brewer.pal(9, "Blues"))
#myColors<-myColors[c(5,9)]


mycols<-c('#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c')

colScale <- scale_fill_manual(name = "ID",values = mycols)


res.plot<-res.plot[res.plot$Country_work=="Canada" | (!(res.plot$Country_work=="Canada") & res.plot$Country_work=="" & res.plot$Country=="Canada"),]
res.plot$ID<-paste(res.plot$type, res.plot$time)


# change order of the levels
res.plot$ID<-as.factor(res.plot$ID)
res.plot$ID<-factor(res.plot$ID, levels(res.plot$ID)[c(4,3,6,5,2,1)])

# add colours to res.plot
mycols<-c('#33a02c','#a6cee3','#fb9a99','#1f78b4', '#e31a1c','#b2df8a')
mycols<-as.data.frame(mycols)
mycols$ID<-levels(res.plot$ID)
res.plot$col<-mycols$mycols[match(res.plot$ID, mycols$ID)]
res.plot$col<-factor(res.plot$col, levels(res.plot$col)[c(3,1,4,2,6,5)])
mycols<-as.character(unique(res.plot$col))
colScale <- scale_fill_manual(name = "ID",values =mycols, labels=c("2006-2010 Fundamental", "2011-2015 Fundamental","2006-2010 Use-inspired", "2011-2015 Use-inspired","2006-2010 Applied", "2011-2015 Applied"))

ggplot(res.plot, aes(percent, fill=ID)) +
    geom_histogram(position='dodge', binwidth=10, bins=seq(0, 100, 10))  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="Percent", y="Number of responses")+
    theme(aspect.ratio=3/4, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),legend.text=element_text(size = 9),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.72, 0.92), legend.margin=unit(100,"cm"), axis.title.y=element_text(size=11),
          axis.title.x=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9), title=element_text(size = 12)) + colScale + 
  scale_x_continuous(breaks=seq(0,100,10))+scale_y_continuous(expand=c(0,0), limits=c(0,300),breaks=c(0,100,200,300)) +annotate('text',5.4 ,294, label="(a)", size=5)

ggplot(res.plot, aes(percent, fill=ID)) +
    geom_histogram(position='dodge', binwidth=20, bins=seq(0, 100, 20))  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="Percent", y="Number of responses")+
    theme(aspect.ratio=3/4, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),legend.text=element_text(size = 9),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.72, 0.92), legend.margin=unit(100,"cm"), axis.title.y=element_text(size=11),
          axis.title.x=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9), title=element_text(size = 12)) + colScale + 
  scale_x_continuous(breaks=seq(0,100,20))+scale_y_continuous(expand=c(0,0), limits=c(0,400),breaks=c(0,100,200,300,400)) +annotate('text', 5.4,390, label="(a)", size=5)

ggplot(res.plot, aes(percent, fill=ID)) +
    geom_histogram(position=position_dodge(width=9), binwidth=30, bins=seq(0, 100, 30))  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="Percent", y="Number of responses")+
    theme(aspect.ratio=3/4, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),legend.text=element_text(size = 9),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.72, 0.92), legend.margin=unit(100,"cm"), axis.title.y=element_text(size=11),
          axis.title.x=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9), title=element_text(size = 12)) + colScale + 
  scale_x_continuous(breaks=seq(0,100,30))+scale_y_continuous(expand=c(0,0), limits=c(0,400),breaks=c(0,100,200,300,400)) +annotate('text', 5.4,390, label="(a)", size=5)

ggplot(res.plot, aes(percent, fill=ID)) +
    geom_histogram(position='dodge', binwidth=30, bins=seq(0, 100, 30))  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="Percent", y="Number of responses")+
    theme(aspect.ratio=3/4, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          legend.key=element_blank(),legend.text=element_text(size = 9),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.72, 0.92), legend.margin=unit(100,"cm"), axis.title.y=element_text(size=11),
          axis.title.x=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9), title=element_text(size = 12)) + colScale + 
  scale_x_continuous(breaks=seq(0,100,30))+scale_y_continuous(expand=c(0,0), limits=c(0,400),breaks=c(0,100,200,300,400)) +annotate('text', 5.4,390, label="(a)", size=5)



#out<-by(data = res.plot, INDICES = res.plot$type, FUN = function(m){
#  m <- droplevels(m)
#  m$col<-factor(m$col, levels(m$col)[c(3,1,4,2,6,5)])
#  mycols<-as.character(unique(m$col))
#  colScale <- scale_fill_manual(name = "ID",values =mycols, labels=c("2006-2010", "2011-2015"))
#  m <- ggplot(m, aes(percent, fill=ID)) +
#    geom_histogram(position='dodge', binwidth=10, bins=seq(0, 100, 10))  +
#    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
#    labs(x="Percent", y="Number of responses", title=m$type)+
#    theme(panel.grid.major = element_blank(),
#          panel.grid.minor = element_blank(),
#          strip.text.y = element_text(size=12, face="bold", color="black"),
#          strip.background = element_rect(colour="white", fill="white"),
#          legend.position=c(0.94, 0.72), legend.margin=unit(100,"cm"), axis.title.y=element_text(size=11),
#          axis.title.x=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9), title=element_text(size = 12)) + colScale + 
#  scale_x_continuous(breaks=seq(0,100,10))+scale_y_continuous(expand=c(0,0), limits=c(0,300),breaks=c(0,100,200,300)) 
# })
#do.call(grid.arrange, out)
  
```

```{r, echo=FALSE, fig.cap="Figure 4.4 Change in research type proportions and the reasons. Researchers were asked to answer yes, no, or can't comment on if their type of research had changed in the last 10 years and to select what reasons for the change applied to them.", message=FALSE, warning=FALSE, fig.width=10}
#Change yes or no
#yes.no<-subset(research.change, select=c("Location","Country", "Country_work",  "gender", "changed_10yrs"))
#canada<-yes.no[yes.no$Country_work=="Canada" | (!(yes.no$Country_work=="Canada") & 
#                                                  yes.no$Country_work=="" & yes.no$Country=="Canada"),]
#canada.yesno<-aggregate(Country~ changed_10yrs, canada, length)
#canada.yesno<-canada.yesno[!canada.yesno$changed_10yrs=="",]

#p1<-ggplot(data=canada.yesno, aes(x=changed_10yrs, y=Country, fill=Country))+ geom_bar(stat='identity') + guides(fill=FALSE)+
#  theme(panel.grid.major = element_blank(),
#          panel.grid.minor = element_blank(), axis.title.x=element_blank())+geom_text(aes(label=Country), vjust=-0.5)+labs(y="Number of responses")+ scale_y_continuous(expand = c(0, 0), limits = c(0,675))+ annotate('text', 3.5,660, label="(a)", size=5)
  
####reason for change  
reason<-subset(research.change, select=c("Location","Country","Country_work",  "gender", "Main_reason_change_interest_related",
                                       "Main_reason_change_Career_related","Main_reason_change_Funding_related", "Main_reason_change_Socially_related","Main_reason_change_Other"))

canada<-reason[reason$Country_work=="Canada" | (!(reason$Country_work=="Canada") & 
                                                  reason$Country_work=="" & reason$Country=="Canada"),]
# switch to long format
require(tidyr)
canada.long<-gather(canada, reason.change.ca, yes.ca, -Location, -gender, -Country_work, -Country)
# using table to count cases of each category
sum.canada<-data.frame(table(canada.long$reason.change.ca, canada.long$yes.ca))
#remove non-response
sum.canada<-sum.canada[!sum.canada$Var1=="",]

sum.canada$Var1<-revalue(sum.canada$Var1, c("Main_reason_change_Career_related" = "Career", "Main_reason_change_Funding_related" = "Funding", "Main_reason_change_interest_related" = "Interest", "Main_reason_change_Other" = "Other", "Main_reason_change_Socially_related"  = "Social"))
myColors4<-(brewer.pal(9, "Blues"))
myColors4<-myColors4[c(9, 8,7,6,5,3)]

p2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+ 
  theme(aspect.ratio=3/4, axis.text.x = element_text(angle=0, vjust=0.5, size=9), axis.text.y=element_text(size = 9), axis.title=element_text(size = 11), panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),legend.text=element_text(size = 9),axis.title.x=element_blank()) +guides(fill=FALSE) +scale_fill_manual(name = "Var1",values = myColors4)+
  labs(y="")+
  scale_y_continuous(expand = c(0, 0), limits = c(0,430))+annotate('text', 5.4,420, label="(b)", size=5)
  

print(p2)

#grid.arrange(p1, p2, nrow=1)
```

```{r, echo=FALSE, fig.cap="Figure 4.5 View of change in proportion of research. Researchers were asked how they viewed the change in the type of research they conduct/supervise.", message=FALSE, warning=FALSE, fig.width=10}
canada<-part1.view[part1.view$Country_work=="Canada" | (!(part1.view$Country_work=="Canada") & 
                                                          part1.view$Country_work=="" & part1.view$Country=="Canada"),]
canada<-canada[!canada$view_change_of_type=="",]
canada<-droplevels(canada)
change.view.ca<-aggregate(gender~ view_change_of_type, canada, length)
# change order of the levels
change.view.ca$view_change_of_type<-factor(change.view.ca$view_change_of_type, 
                                        levels(change.view.ca$view_change_of_type)[c(5,3,1,2,4)])

myColors5<-(brewer.pal(9, "Blues"))
myColors5<-myColors5[c(4,4,4,4,4,4)]

ggplot(change.view.ca, aes(x=view_change_of_type, y=gender, fill=view_change_of_type)) + geom_bar(stat='identity')+
  theme(aspect.ratio=3/4, axis.text.x = element_text(angle=0, vjust=0.5, size=9), axis.text.y = element_text(size = 9), axis.title.y = element_text(size = 11), axis.title.x = element_text(size = 11)) +guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(),legend.text=element_text(size = 9), panel.grid.minor = element_blank())+ labs(x="", y="Number of responses")+geom_text(aes(label=gender), vjust=-0.5, size=3)+scale_y_continuous(expand = c(0, 0), limits = c(0,137))+scale_fill_manual(name='view_change_of_type', values=myColors5)+annotate('text', 5.4,133, label="(c)", size=5)

```

```{r, echo=FALSE, fig.cap="Figure 4.1 Type of research (4.3, 4.4, 4.5)", message=FALSE, warning=FALSE, fig.width=10}
# Setup
#pdf(file = "../figures/effects_fig.pdf",width=7, height=4) # Open a pdf that is 7x3.5 inches
#plot.new()
#par(mar=c(0,0,0,0)) # Set the margins all to 0
#par(mai=c(.3,.2,.2,.2)) # Set the distance (in inches) between panels
#layout(matrix(c(1,2,1,3),nrow=2), widths=c(1,1,2), heights=c(1.5,2,2)) # Set up the layout for a 3-panel plot



##plot 1
# add colours to res.plot
mycols<-c('#33a02c','#a6cee3','#fb9a99','#1f78b4', '#e31a1c','#b2df8a')
mycols<-as.data.frame(mycols)
mycols$ID<-levels(res.plot$ID)
res.plot$col<-mycols$mycols[match(res.plot$ID, mycols$ID)]
res.plot$col<-factor(res.plot$col, levels(res.plot$col)[c(3,1,4,2,6,5)])
mycols<-as.character(unique(res.plot$col))
colScale <- scale_fill_manual(name = "ID",values =mycols, labels=c("2006-2010\nFundamental", "2011-2015\nFundamental","2006-2010\nUse-inspired", "2011-2015\nUse-inspired","2006-2010\nApplied", "2011-2015\nApplied"))

g1<-ggplot(res.plot, aes(percent, fill=ID)) +
    geom_histogram(position='dodge', binwidth=20, bins=seq(0, 100, 20))  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="Percent", y="Number of responses")+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),legend.text=element_text(size = 9),
          strip.text.y = element_text(size=12, face="bold", color="black"), legend.key.size=unit(0.65,"cm"),legend.key=element_rect(color=NA, size=40),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.78, 0.91), legend.margin=unit(100,"cm"), axis.title.y=element_text(size=11),
          axis.title.x=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9), title=element_text(size = 12)) + colScale + 
  scale_x_continuous(breaks=seq(0,100,20), expand = c(0.015,0.015))+scale_y_continuous(expand=c(0,0), limits=c(0,400),breaks=c(0,100,200,300,400)) +annotate('text', -9,388, label="(a)", size=5)

#g1

###plot2

myColors4<-(brewer.pal(9, "Blues"))
myColors4<-myColors4[c(9, 8,7,6,5,3)]

g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+ 
  theme(axis.text.x = element_text(angle=0, vjust=0.5, size=9), axis.text.y=element_text(size = 9), axis.title=element_text(size = 11),panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),legend.text=element_text(size = 9),axis.text.x = element_text(angle=0, vjust=0.5),axis.title.x=element_blank()) +guides(fill=FALSE) +scale_fill_manual(name = "Var1",values = myColors4)+
  labs(y="Number of responses", x="")+
  scale_y_continuous(expand = c(0, 0), limits = c(0,430))+annotate('text', 5.3,415, label="(b)", size=5)+scale_x_discrete(labels=c("Funding\n  ", "Interest\n  ", 
                                    "Career\n  ", "Social\n  ", "Other\n  "))
#g2


###plot 3
myColors5<-(brewer.pal(9, "Blues"))
myColors5<-myColors5[c(4,4,4,4,4,4)]

g3<-ggplot(change.view.ca, aes(x=view_change_of_type, y=gender, fill=view_change_of_type)) + geom_bar(stat='identity')+
  theme(axis.text.x = element_text(angle=0, vjust=0.5, size=9), axis.text.y = element_text(size = 9), axis.title.y = element_text(size = 11), axis.title.x = element_text(size = 11)) +guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(),legend.text=element_text(size = 9), panel.grid.minor = element_blank())+ labs(x=NULL, y="Number of responses")+geom_text(aes(label=gender), vjust=-0.5, size=3)+scale_y_continuous(expand = c(0, 0), limits = c(0,137))+scale_fill_manual(name='view_change_of_type', values=myColors5)+annotate('text', 5.3,132, label="(c)", size=5)+scale_x_discrete(labels=c("Very\npositive", "Slightly\npositive", 
                                    "Neutral", "Slightly\nnegative", "Very\nnegative"))
#g3

#width<-matrix(c(50,10,50,10), ncol=1, nrow = 2)


multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}

multiplot(g1, g2, g3, layout = matrix(c(1,1,2,3),nrow=2, byrow=TRUE))

```




<!--Part 2 - External Partnerships-->
**4.2 External Partnerships**   
The extent to which research is conducted with partners outside of academia, including in industry and non-governmental sectors, may also be considered as an indicator of use-inspired or applied research. Almost all respondents (88%) reported that their current research includes external partners to some degree: fifty-nine per cent reported some partnerships and a further quarter (27%) reported strong partnerships (Figure 4.6). Less than 1% reported conducting their research exclusively with partners outside of academia. 

Over the past decade, there has been a sharp decline in the number of researchers with no external partnerships: only 12% of respondents reported having no partnerhips in their current research program, whereas almost half of respondents (44%) reported having no partnerships in the past (Figure 4.6). The number of strong external partnerships also has increased over time from 11% to 27% (Figure 4.6). 

Funding was the driving force behind the shift towards external partnerhips. Half of Canadian respondents reported that they developed external partnerships in order to secure funding (Figure 4.7). The remaining half of respondents developed partnerships out of interest (24%), or for career (12%) or social reasons (<1%) (Figure 4.7).

Perspectives on these changes were mixed (Figure 4.8). Interestly, almost half of respondents (49%) viewed the change in external partnerships as slightly or very positive. Twenty per cent were indifferent to the change and thirty-one percent of respondents viewed them as slightly or very negative.

```{r, echo=FALSE, fig.cap="Figure 4.6 Current vs past level of partnership outside of academia. Researchers indicated the level of partnership that their current and past (10 years ago) research program had outside of academia).", warning=FALSE}
part2.b.a<-part2.b.a[part2.b.a$Country_work=="Canada" | (!(part2.b.a$Country_work=="Canada") & part2.b.a$Country_work=="" & part2.b.a$Country=="Canada"),]

b.part<-data.frame(table(part2.b.a$partnership_outside_before))
b.part$time<-"Past"
a.part<-data.frame(table(part2.b.a$partnership_outside))
a.part$time<-"Current"

part<-rbind(a.part, b.part)
part$Var1<-factor(part$Var1, levels(part$Var1)[c(1,4,3,2)])
part$time<-factor(part$time)
part$time<-factor(part$time, levels(part$time)[c(2,1)])

myColors6<-(brewer.pal(9, "Blues"))
myColors6<-rev(myColors6[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors6)

ggplot(part, aes(x=Var1, y=Freq, fill = time),  ylim(0,375)) + 
  geom_bar( stat='identity', position="dodge") +
  geom_text(aes(label=Freq), position=position_dodge(width=1), vjust=-0.5, size=3) +
  labs(x="", y="Number of responses", fill="")+
  theme(aspect.ratio=3/4, panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.key=element_blank(),legend.text=element_text(size = 9),
        axis.text.x = element_text(angle=0, size=9), axis.text.y=element_text(size = 9), axis.title=element_text(size = 11), 
        legend.position=c(0.91, 0.92), 
        legend.title=element_blank()) +
  colScale+scale_y_continuous(expand = c(0, 0), limits = c(0,340))
```

```{r, echo=FALSE, fig.cap="Figure 4.7 Reasons for change in level of external research partnerships over the past decade.", warning=FALSE}
### was there change
#canada<-subset(part2.change, Country=="Canada")
#canada<-part2.change[part2.change$Country_work=="Canada" | (!(part2.change$Country_work=="Canada") & part2.change$Country_work=="" & part2.change$Country=="Canada"),]
#change.part.ca<-data.frame(table(canada$partnership_change_10yrs))
#change.part.ca$Var1<-revalue(change.part.ca$Var1, c("Can't comment (new researcher)"="Can't comment"))
#change.part.ca$Var1<-factor(change.part.ca$Var1, levels=c("Yes", "No", "Can't comment"))
#myColors<-(brewer.pal(9, "Blues"))
#myColors<-myColors[c(9, 7,5)]
#g1<-ggplot(data=change.part.ca, aes(x=Var1, y=Freq, fill=Var1))+ 
#    geom_bar(stat='identity') + 
#    guides(fill=FALSE) + 
#    labs(x="", y="No. of responses",title="")+
#  geom_text(aes(label=Freq), vjust=-0.5)+
#  theme(panel.grid.major = element_blank(),
#        panel.grid.minor = element_blank()) + 
#  scale_fill_manual(name = "Var1",values = myColors) +
#  annotate('text', 3.25,606, label="(a)", size=7)

### reason
part2.reason<-part2.reason[part2.reason$Country_work=="Canada" | (!(part2.reason$Country_work=="Canada") & part2.reason$Country_work=="" & part2.reason$Country=="Canada"),]
reason.pt.long<-gather(part2.reason, change.reason, yes, -Country,-Country_work, -gender, -Location, -what_participant_group, -field_research)
sum.canada<-data.frame(table(reason.pt.long$change.reason, reason.pt.long$yes))

sum.canada$Var1<-revalue(sum.canada$Var1, c("reason_partnership_change_career" = "Career", "reason_partnership_change_funding" = "Funding", "reason_partnership_change_interest" = "Interest", "reason_partnership_change_other" = "Other", "reason_partnership_change_socially"  = "Social"))
sum.canada$Var1<-reorder(sum.canada$Var1, -sum.canada$Freq)

myColors7<-(brewer.pal(9, "Blues"))
myColors7<-myColors7[c(9, 8,7,6,5,3)]

g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + 
    geom_bar(stat='identity')+  guides(fill=FALSE) +
    theme(aspect.ratio=3/4, axis.text.x = element_text(angle=0, vjust=0.5, size = 9), axis.text.y=element_text(size = 9), axis.title.y=element_text(size = 11),
          legend.position=c(0.8, 0.8), 
          legend.title=element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank()) + 
  geom_text(aes(label=Freq), vjust=-0.5, size=3)+
  labs(x="", y="Number of responses", title="")+scale_fill_manual(name = "Var1",values = myColors7)+
  scale_y_continuous(expand = c(0, 0), limits = c(0,440))
print(g2)
#annotate('text', 5,420, label="(b)", size=7)+  
#grid.arrange(g1, g2, nrow=1)
```

```{r, echo=FALSE, fig.cap="Figure 4.8 View of change in external partnerships. Researchers were asked how they viewed the change in the level of partnership with external groups.", warning=FALSE}
#canada<-subset(part2.view, Country=="Canada")
canada<-part2.view[part2.view$Country_work=="Canada" | (!(part2.view$Country_work=="Canada") & part2.view$Country_work=="" & part2.view$Country=="Canada"),]
view<-data.frame(table(canada$view_change_partnership))
# change order of the levels

view$Var1<-factor(view$Var1, levels(view$Var1)[c(5,3,1,2,4)])

myColors8<-(brewer.pal(9, "Blues"))
myColors8<-myColors8[c(4,4,4,4,4)]
colScale <- scale_fill_manual(name = "Var1",values = myColors8)

ggplot(view, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+
  geom_text(aes(label=Freq, vjust=-0.5), size=3)+
  guides(fill=FALSE)+
  theme(aspect.ratio=3/4, panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle=0, vjust=0, size=9), axis.text.y=element_text(size = 9), axis.title.y=element_text(size=11)) + 
  labs(x="", y="Number of responses") + colScale+scale_y_continuous(expand = c(0, 0), limits = c(0,160), breaks = seq(0,160,40))

```
 
```{r, echo=FALSE, fig.cap="Figure 4.2 External Research Partnerships. ( 4.6 + 4.7 + 4.8 )", warning=FALSE}
###4.6
myColors6<-(brewer.pal(9, "Blues"))
myColors6<-rev(myColors6[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors6)

p4<-ggplot(part, aes(x=Var1, y=Freq, fill = time),  ylim(0,375)) + 
  geom_bar( stat='identity', position="dodge") +
  geom_text(aes(label=Freq), position=position_dodge(width=1), vjust=-0.5, size=3) +
  labs(x="", y="", fill="")+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.key=element_blank(),legend.text=element_text(size = 9),
        axis.text.x = element_text(angle=0, size=9), axis.text.y=element_text(size = 9), axis.title=element_text(size = 11), 
        legend.position=c(0.93, 0.88), 
        legend.title=element_blank()) +
  colScale+scale_y_continuous(expand = c(0, 0), limits = c(0,380))


###4.7
myColors7<-(brewer.pal(9, "Blues"))
myColors7<-myColors7[c(9, 8,7,6,5,3)]

p5<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) + 
    geom_bar(stat='identity')+  guides(fill=FALSE) +
    theme(axis.text.x = element_text(angle=0, vjust=0.5, size = 9), axis.text.y=element_text(size = 9), axis.title.y=element_text(size = 11),
          legend.position=c(0.8, 0.8), 
          legend.title=element_blank(),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank()) + 
  geom_text(aes(label=Freq), vjust=-0.5, size=3)+
  labs(x="", y="", title="")+scale_fill_manual(name = "Var1",values = myColors7)+
  scale_y_continuous(expand = c(0, 0), limits = c(0,450))

###4.8
myColors8<-(brewer.pal(9, "Blues"))
myColors8<-myColors8[c(4,4,4,4,4)]
colScale <- scale_fill_manual(name = "Var1",values = myColors8)

p6<-ggplot(view, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+
  geom_text(aes(label=Freq, vjust=-0.5), size=3)+
  guides(fill=FALSE)+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle=0, vjust=0, size=9), axis.text.y=element_text(size = 9), axis.title.y=element_text(size=11)) + 
  labs(x="", y="") + colScale + scale_y_continuous(expand = c(0, 0), limits = c(0,165), breaks = seq(0,160,40))

label=textGrob("Number of responses", x=unit(0.9, "npc"), y=unit(0.5, "npc"), rot = 90, vjust = 0.5, gp=gpar(fontsize=11)) # make global y axis title
require(grid)
grid.arrange(arrangeGrob(p4, p5, p6, ncol = 1, left =label)) #plot graphs with global y axis title
  
  
  #arrangeGrob(p4,p5,p6, ncol=1), grobs=list(left)
                         
                         #        , heights=c(0.315,0.375,0.315))


```
 
 
 
 
<!--Part 3 - Grant Application History-->
**4.3 Research Grants**  

There has been an overall increase in the number of grant applications (Figure 4.9). Between one and nine, inclusive, applied research grant applications had the biggest increase, however the number of researchers that applied for 10+ fundamental grants increased more than the applied or use-inspired.  This may indicate either lower success rates and/or smaller grant values of fundamental grants and therefore a need to apply more often for those grants.  
*I have those numbers if we want to put them in*

With an increase in the number of grant applications one would expect that the success rates would decrease due to more scientists competing for the same money. This is demonstrated by a decrease in the 100% successfull (29% of total Fundamental responses to 23%) and an increase in unsuccessful (7% to 11%) fundamental grant applications (Figure 4.10).  However, this is untrue for the applied grant applications because the unsuccessful decreased (18% of total applied responses to 14%) and successful applications increased (24% to 28%).  This potentially shows an increase in available funding for this type of research compared to the funding availablity for fundamental research.  Proportionally there was no change in the responses for 0%, 50%, or 100% for the Use-Inspired grant applications. When asked their opinion on changing success rates over 80% of the respondents think that the success rate of fundamental research grant applications have decreased slightly or decreased considerably in the past ten years (Figure 4.11). Only 0.08% believe that the success rate has stayed the same or increased.  The decrease in success could be due to in the increase in grant applications but there was only a 10% overall increase in Fundamental research grant applications.  Applied research grant applications saw the reverse of the Fundamental research where 57% of respondents believe the success rate has improved. Use-Inspired research grant applications were in the middle but leaned more towards increased success.

Requirements, such as listing practical applications or having external partners, for grant application success can also indicate use-inspired or applied research. The majority of the respondents believe that it is now either mandatory (24%) or very important (34%) to suggest practical applications of their research in order for their grant applications to be successful. This has shifted over time, with 26% researchers reporting that between 2006 and 2010 it was only somewhat important to do so (Figure 4.12).  Similarly the shift was also seen in the belief of external partners being either mandatory (14%) or quite important (36%) for the grant application's success (Figure 4.13). 

The government is the primary funding source for scientists thus the research priorities of the Canadian government can have a dramatic impact on research (Figure 4.14). 14% of respondents currently rely entirely on the government for funding of their research program and 78% of respondents fund 50% or more of their research program with governmental money.  That leaves less than a quarter of respondents that find support for 50% or more of their research from other sources. The increase of the number of responses between the two time frames can be explained by an increase in the number of researchers (i.e. number of responses that were not "New researcher (no funding in these years)" for governmental funding for 2006-2010 was 1103 and the number for 2011-2015 was 1303).


```{r, echo=FALSE, fig.cap="Fig. 4.9 Number of research grant applications by research category in 2006-2010 and 2011-2015.", warning=FALSE, fig.height=12}
#canada<-subset(part3.grants.long, Country=="Canada")
canada<-part3.grants.long[part3.grants.long$Country_work=="Canada" | (!(part3.grants.long$Country_work=="Canada") & part3.grants.long$Country_work=="" & part3.grants.long$Country=="Canada"),]
canada$type.grant<-as.character(canada$type.grant)


#add time variable
canada$time<-ifelse(grepl("11_15", canada$type.grant), "2011-2015", "2006-2010")
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_applied"]<-"Applied"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_applied"]<-"Applied"

grants.ca<-data.frame(with(canada, table(type.grant,time,number)))
grants.ca$type.grant<-as.factor(grants.ca$type.grant)


#change order of levels
grants.ca$number<-factor(grants.ca$number, levels(grants.ca$number)[c(1,2,6,7,3,4,5)])
grants.ca$type.grant<-factor(grants.ca$type.grant, levels(grants.ca$type.grant)[c(2,3,1)])

myColors9<-(brewer.pal(9, "Blues"))
myColors9<-rev(myColors9[c(9, 5)])
colScale <- scale_fill_manual(name = "time",values = myColors9)


ggplot(grants.ca, aes(number, Freq, fill=time), width=0.7) + 
    geom_bar(stat="identity", position = "dodge")+
    facet_wrap(~type.grant, ncol=3) +
    guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
    labs(x="Number of grant applications", y="Number of responses")+
    theme(aspect.ratio=4/3, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          legend.key=element_blank(),legend.text=element_text(size = 9),
           strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.91, 0.89), legend.text=element_text(size = 9), axis.title.x=element_text(size = 11),
          axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9)) + 
  colScale+scale_y_continuous(expand = c(0, 0), limits = c(0,950), breaks = c(0,250,500,750,950))
```

```{r, echo=FALSE, fig.cap="Fig 4.10 Research grant application success over the past 10 years. Researchers were asked to estimate the percentage of their research grant applications that were successful, in 2006-2010 and in 2011-2015. Respondents also had the choice to answer No need for applications for this research type.", warning=FALSE}
#canada<-subset(part3.success.long, Country=="Canada")
canada<-part3.success.long[part3.success.long$Country_work=="Canada" | (!(part3.success.long$Country_work=="Canada") & part3.success.long$Country_work=="" & part3.success.long$Country=="Canada"),]
canada$type<-as.character(canada$type)

#add time variable
canada$time<-ifelse(grepl("11_15", canada$type), "2011-2015", "2006-2010")
canada$type[canada$type=="successful_grants_11_15_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_6_10_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_11_15_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_6_10_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_11_15_applied"]<-"Applied"
canada$type[canada$type=="successful_grants_6_10_applied"]<-"Applied"

success.ca<-data.frame(with(canada, table(type, percent,time)))



#change order of types
success.ca$type<-as.factor(success.ca$type)
success.ca$type<-factor(success.ca$type, levels(success.ca$type)[c(2,3,1)])

success.ca$id<-paste(success.ca$type, success.ca$time)

# change order of the levels
success.ca$id<-as.factor(success.ca$id)
success.ca$id<-factor(success.ca$id, levels(success.ca$id)[c(3,4,5,6,1,2)])

mycols10<-c('#1f78b4','#a6cee3','#33a02c','#b2df8a','#e31a1c', '#fb9a99')
mycols10<-as.data.frame(mycols10)
mycols10$id<-levels(success.ca$id)
success.ca$col<-mycols10$mycols10[match(success.ca$id, mycols10$id)]
success.ca$col<-factor(success.ca$col, levels(success.ca$col)[c(3,1,4,2,6,5)])


out2<-by(data = success.ca, INDICES = success.ca$type, FUN = function(n){
  n <- droplevels(n)
  n$col<-factor(n$col, levels(n$col)[c(3,1,4,2,6,5)])
  mycols10<-as.character(unique(n$col))
  colScale <- scale_fill_manual(name = "id",values =mycols10, labels=c("2006-2010", "2011-2015"))
  n <- ggplot(n, aes(percent, Freq, fill=id)) +
    geom_bar(stat="identity", position='dodge')  +
    guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
    labs(x="Percent of successful grants", y="Number of responses", title=n$type)+
    theme(aspect.ratio=1/4, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          legend.key=element_blank(),legend.text=element_text(size = 9),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
           axis.title.y=element_text(size=11),
          axis.title.x=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9), title=element_text(size = 12)) + colScale +
    scale_y_continuous(expand=c(0,0), limits=c(0,300))
 })
do.call(grid.arrange, out2)



#ggplot(success.ca, aes(percent, Freq, fill=time)) + 
#    geom_bar(stat="identity", position = "dodge")+
#     facet_wrap(~type, nrow=3) +
#    guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
#    labs(x="Perceived percentage of successful grants", y="Number of responses")+
#    theme(panel.grid.major = element_blank(),
#          panel.grid.minor = element_blank(),
#           strip.text.y = element_text(size=12, face="bold", color="black"),
#          strip.background = element_rect(colour="white", fill="white"),
#          legend.position=c(0.955, 0.58), legend.margin=unit(-1000,"cm"), legend.text=element_text(size = 9), axis.title.x=element_text(size = 11),
#          axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9)) + colScale+
#  scale_y_continuous(expand = c(0, 0), limits = c(0,300))



```
 
```{r, echo=FALSE, fig.cap="Fig 4.11 Change in grant success rates over the past 10 years. Researchers were asked if they thought that grant sucecss rates have changed in the past 10 years, for each research category.", warning=FALSE}
canada<-part3.change[part3.change$Country_work=="Canada" | (!(part3.change$Country_work=="Canada") & part3.change$Country_work=="" & part3.change$Country=="Canada"),]

##switch to long format
change.long.ca<-gather(canada, type, level, -Location, -gender, -Country, -Country_work, -what_participant_group, -field_research)
success.change<-with(change.long.ca, data.frame(table(type, level)))
#remove no response
success.change<-success.change[!success.change$level=="",]
success.change<-droplevels(success.change)

# add colour palette
myColors11<-c('#1f78b4','#33a02c','#e31a1c')
colScale <- scale_fill_manual(name = "type",values = myColors11, labels=c("Fundamental", "Use-inspired", "Applied"))

#change order of levels
success.change$level<-factor(success.change$level, levels(success.change$level)[c(5,4,6,2,3,1)])
success.change$type<-factor(success.change$type, levels(success.change$type)[c(2,3,1)])
success.change$type<-revalue(success.change$type, c("success_change_10yrs_fundamental"="Fundamental",
              'success_change_10yrs_use'='Use-inspired', 'success_change_10yrs_applied' = 'Applied'))

ggplot(data=success.change, aes(x=level, Freq, fill=type))+ facet_wrap(~type, nrow=3)+
  geom_bar(stat="identity", position="dodge")+
  guides(fill=guide_legend(title=NULL)) +
  theme(aspect.ratio=1/4, axis.text.x = element_text(angle=0, vjust=0.5, size = 9), axis.text.y=element_text(size = 9), axis.title.y=element_text(size = 11),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
         strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
        legend.position=c(0.15, 0.9))+
  guides(fill=FALSE)+
  geom_text(aes(label=Freq, vjust=-0.4),size=3) +
  scale_x_discrete(labels=c("Increased\n considerably", "Increased\n slightly", 
                                    "Stayed the\n same", "Decreased\n slightly", "Decreased\n considerably", "Can't\n comment"),limits = (levels(success.change$level)))+
  labs(x="", y="Number of responses", fill="")+ colScale+
  scale_y_continuous(expand = c(0, 0), limits = c(0,635))
```

```{r, echo=FALSE, fig.cap="Fig 4.12 Importance of practical application of research over the past 10 years. Researchers were asked how important it was to suggest practical applications of their research to ensure that the grant was successful, in 2006-2010 and in 2011-2015.", warning=FALSE}

canada<-part3.prac.long[part3.prac.long$Country_work=="Canada" | (!(part3.prac.long$Country_work=="Canada") & part3.prac.long$Country_work=="" & part3.prac.long$Country=="Canada"),]

canada$year<-as.character(canada$year)

canada$year[canada$year=="practical_applications_important_11_15"]<-"2011-2015"
canada$year[canada$year=="practical_applications_important_6_10"]<-"2006-2010"


prac.ca<-data.frame(table(canada$year, canada$level))

#change order of levels
prac.ca$Var2<-factor(prac.ca$Var2, levels(prac.ca$Var2)[c(2,6,4,5,3,1)])

myColors12<-(brewer.pal(9, "Blues"))
myColors12<-rev(myColors12[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors12)


ggplot(prac.ca, aes(Var2, Freq, fill=Var1)) + 
  geom_bar(stat="identity", position = "dodge")+
  theme(aspect.ratio=3/4, panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.key=element_blank(),legend.text=element_text(size = 9),
        legend.position=c(0.89, 0.91),
        axis.text.x = element_text(angle=0, vjust=0.5, size = 9), axis.text.y=element_text(size = 9), axis.title.x=element_text(size = 11),
        axis.title.y=element_text(size = 11)) +
  guides(fill=guide_legend(title=NULL, reverse=FALSE)) + 
  scale_x_discrete(labels=c("Mandatory", "Very\n important","Quite\n important", 'Somewhat\n important', 'Not at all\n important', "Can't\n comment"))+
  labs(x="Importance of suggesting practical research applications", y="Number of responses")+ colScale+
  scale_y_continuous(expand = c(0, 0), limits = c(0,440))
  

```

```{r, echo=FALSE, fig.cap="Fig 4.13 Importance of including partners from for-profit or non-governmental sectors in grant success. Researchers were asked how important it was to include external partnerships in their research to ensure that the grant was successful, in 2006-2010 and in 2011-2015.", warning=FALSE}

canada<-part3.part.long[part3.part.long$Country_work=="Canada" | (!(part3.part.long$Country_work=="Canada") & part3.part.long$Country_work=="" & part3.part.long$Country=="Canada"),]

canada$year<-as.character(canada$year)

canada$year[canada$year=="include_nonacademia_partners_success_11_15"]<-"2011-2015"
canada$year[canada$year=="include_nonacademia_partners_success_6_10"]<-"2006-2010"

part.ca<-data.frame(table(canada$year, canada$level))
#change order of levels
part.ca$Var2<-factor(part.ca$Var2, levels(part.ca$Var2)[c(2,5,6,4,3,1)])

## add colour scale
myColors13<-(brewer.pal(9, "Blues"))
myColors13<-rev(myColors13[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors13)


ggplot(part.ca, aes(Var2, Freq, fill=Var1))+ 
  geom_bar(stat="identity", position = "dodge")+
    guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
    labs(x="Importance of external partnerships", y="Number of responses")+
  scale_x_discrete(labels=c("Mandatory", "Quite\n important", 'Somewhat\n important',"Not very\n important", 'Not at all\n important', "Can't\n comment"))+
    theme(aspect.ratio=3/4, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),legend.text=element_text(size = 9),
          legend.key=element_blank(),
          legend.position=c(0.89, 0.91), axis.text.x=element_text(size = 9), axis.text.y=element_text(size=9),
          axis.title.x=element_text(size = 11), axis.title.y=element_text(size = 11)) + colScale+
  scale_y_continuous(expand = c(0, 0), limits = c(0,480))
```

```{r, echo=TRUE, fig.cap="Fig 4.4 Importance of practical applications and external partnerships. (4.12 + 4.13)", warning=FALSE}
###4.12
myColors12<-(brewer.pal(9, "Blues"))
myColors12<-rev(myColors12[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors12)


p10<-ggplot(prac.ca, aes(Var2, Freq, fill=Var1)) + 
  geom_bar(stat="identity", position = "dodge")+
  theme(aspect.ratio=3/4, panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.key=element_blank(),
        legend.position=c(0.85, 0.865), legend.text=element_text(size = 9),
        axis.text.x = element_text(angle=0, vjust=0.5, size = 9), axis.text.y=element_text(size = 9), axis.title.x=element_text(size = 11),
        axis.title.y=element_text(size = 11)) +
  guides(fill=guide_legend(title=NULL, reverse=FALSE)) + 
  scale_x_discrete(labels=c("Mandatory", "Very\n important","Quite\n important", 'Somewhat\n important', 'Not at all\n important', "Can't\n comment"))+
  labs(x="Importance of suggesting practical research applications", y="Number of responses")+ colScale+
  scale_y_continuous(expand = c(0, 0), limits = c(0,440))

###4.13
myColors13<-(brewer.pal(9, "Blues"))
myColors13<-rev(myColors13[c(9, 5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors13)


p11<-ggplot(part.ca, aes(Var2, Freq, fill=Var1))+ 
  geom_bar(stat="identity", position = "dodge")+
    guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
    labs(x="Importance of external partnerships", y="")+
  scale_x_discrete(labels=c("Mandatory", "Quite\n important", 'Somewhat\n important',"Not very\n important", 'Not at all\n important', "Can't\n comment"))+
    theme(aspect.ratio=3/4, panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          legend.key=element_blank(),legend.text=element_text(size = 9),
          legend.position=c(0.85, 0.865), axis.text.x=element_text(size = 9), axis.text.y=element_text(size=9),
          axis.title.x=element_text(size = 11), axis.title.y=element_text(size = 11)) + colScale+
  scale_y_continuous(expand = c(0, 0), limits = c(0,480))

grid.arrange(p10,p11, widths=c(0.5,0.5), nrow=1)

```



```{r, eval=FALSE, fig.cap="Fig 4.14 *******  NO ******* Distribution of research funding over the past 10 years. Researchers were asked to estimate the distribution of their research funding sources in 2006-2010 and 2011-2015.", fig.height=12, warning=FALSE, include=FALSE}

canada<-p3_master.long[p3_master.long$Country_work=="Canada" | (!(p3_master.long$Country_work=="Canada") & p3_master.long$Country_work=="" & p3_master.long$Country=="Canada"),]

##revalue the year values
canada$year<- revalue(canada$year, c("11_15"="2011-2015", "6_10"="2006-2010"))
#change order of levels
canada$year<-factor(canada$year, levels(canada$year)[c(2,1)])

myColors14<-(brewer.pal(9, "Blues"))
myColors14<-rev(myColors14[c(9, 5)])
colScale <- scale_fill_manual(name = "year",values = myColors14)

##attempt 1
p14<-ggplot(canada, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=10)  + 
  facet_wrap(~type) + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.922, 0.98),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          legend.key.size = unit(0.3, "cm"),
          strip.background = element_rect(colour="white", fill="white"),panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.text.x=element_text(size = 9), axis.text.y=element_text(size = 9), legend.key=element_blank(),
          axis.title.x=element_text(size=11), axis.title.y=element_text(size = 11)) +
  labs(x="% research funding", y = "Number of responses")+
  scale_y_continuous(expand =c(0,0), limits=c(0,1300), breaks=c(0, 250, 500, 750, 1000, 1250))+
  scale_x_continuous( breaks = seq(0, 100, 10))

g<- ggplotGrob(p14)

gl<- g$layout
idcol<-gl$r==(ncol(g)-2)
g$layout[idcol & gl$b < 5, c("t", "b")] <- gl[idcol & gl$b < 5, c("t", "b")] + 4
grid.newpage()
grid.draw(g)

###attempt 2
p14=ggplot(canada, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=10)  + 
  facet_wrap(~type, nrow=2) + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.922, 0.98),
          strip.text.y = element_text(size=12, face="bold", color="black"),
          legend.key.size = unit(0.3, "cm"),
          strip.background = element_rect(colour="white", fill="white"),panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.text.x=element_text(size = 9), axis.text.y=element_text(size = 9), legend.key=element_blank(),
          axis.title.x=element_text(size=11), axis.title.y=element_text(size = 11)) +
  labs(x="% research funding", y = "Number of responses")+
  scale_y_continuous(expand =c(0,0), limits=c(0,1300), breaks=c(0, 250, 500, 750, 1000, 1250))+
  scale_x_continuous( breaks = seq(0, 100, 10))


g=ggplotGrob(p14)

panels=which(sapply(g[["width"]], "attr", "unit") == "null")
g[["width"]][panels] = list(unit(10, "cm"), unit(10, "cm"), unit(10, "cm"), unit(15, "cm"), unit(15, "cm"))

#device.width = convertWidth(sum(g[["width"]]), "inches", valueOnly=TRUE)

pdf("test.pdf", width=40)
grid.draw(g)
dev.off()

###attempt 3

canada$g.row<-ifelse(canada$type=="For-Profit"| canada$type=="Government", "top", "bottom")

canada$g.row<-factor(canada$g.row, levels = c("top", "bottom"))


# Get y max to use same scale.
yMax <- max(canada$percent)

# Get dyes.
position <- levels(canada$g.row)

# start new page
plot.new() 

# setup layout
gl <- grid.layout(nrow=length(position) , ncol=1)
# grid.show.layout(gl) # To inspect layout.

# Init layout
pushViewport(viewport(layout=gl))

# Loop over all dyes.
for(d in seq(along=position)){

  # Move to the next viewport
  pushViewport(viewport(layout.pos.col=1, layout.pos.row=d))

  # Create a plot for the current subset.  
  gp <- ggplot(subset(canada, g.row==position[d]), aes_string(x = "percent", y = "gender")) 
  gp <- gp + geom_point(aes_string(colour = colScale), alpha = 0.8, position = position_jitter(width = 0.1))
  gp <- gp + facet_grid(g.row ~ type)
  gp <- gp + ylim(0, yMax)

  # If first dye channel.
  if(d == 1){

    # Plot title only.
    gp <- gp + labs(title = "")
    gp <- gp + theme(axis.title.x=element_blank())
    gp <- gp + theme(axis.title.y=element_blank())

    # Remove legends.
    gp <- gp + theme(legend.position="none")

  } else if(d == length(position)){ # If last dye channel.

    # No title but x and y labels.
    # Y label should ideally be centered vertically in final plot.
    gp <- gp + labs(title = element_blank())
    gp <- gp + labs(xlab = "% research funding")
    gp <- gp + labs(xlab = "Number of responses")

    # Not removing legend works but makes the last plot more compact (horizontally).
    # Can the panel height or width be fixed for all subplots?

    # 'bottom' is nicer (assuming I can't center it vertically in the final plot)
    # but makes the last dye channel very compact (vertically).
    # gp <- gp + theme(legend.position="bottom")

  } else {  # No titles, labels or legends.

    gp <- gp + labs(title = element_blank())
    gp <- gp + theme(axis.title.x = element_blank())
    gp <- gp + theme(axis.title.y = element_blank())
    gp <- gp + theme(legend.position="none")
  }

  # Print the ggplot graphics here
  print(gp, newpage = FALSE)

  # Done with this viewport
  popViewport(1)

}

#Plot using grid.layout

```


```{r, echo=FALSE, fig.cap="Fig 4.14 Distribution of research funding over the past 10 years. Researchers were asked to estimate the distribution of their research funding sources in 2006-2010 and 2011-2015.", fig.height=12, warning=FALSE}

canada<-p3_master.long[p3_master.long$Country_work=="Canada" | (!(p3_master.long$Country_work=="Canada") & p3_master.long$Country_work=="" & p3_master.long$Country=="Canada"),]

##revalue the year values
canada$year<- revalue(canada$year, c("11_15"="2011-2015", "6_10"="2006-2010"))
#change order of levels
canada$year<-factor(canada$year, levels(canada$year)[c(2,1)])

##For-Profit
fp<-canada[canada$type=="For-Profit",]

myColors14<-(brewer.pal(9, "Blues"))
myColors14<-rev(myColors14[c(9, 5)])
colScale <- scale_fill_manual(name = "year",values = myColors14)

p1<-ggplot(fp, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=10)  + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.922, 0.98), 
          legend.key.size = unit(0.3, "cm"), plot.title = element_text(size=12, hjust = 0.5),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.text.x=element_text(size = 9), axis.text.y=element_text(size = 9), legend.key=element_blank(),
          axis.title.x=element_text(size=11), axis.title.y=element_text(size = 11)) +
  labs(list(title= "For-Profit", x="", y = "Number of responses"))+
  scale_y_continuous(expand =c(0,0), limits=c(0,1300), breaks=c(0, 250, 500, 750, 1000, 1250))+
  scale_x_continuous( breaks = seq(0, 100, 10))
p1


##Government
gov<-canada[canada$type=="Government",]

myColors14<-(brewer.pal(9, "Blues"))
myColors14<-rev(myColors14[c(9, 5)])
colScale <- scale_fill_manual(name = "year",values = myColors14)

p2<-ggplot(gov, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=10)  + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.9, 0.93),
          legend.key.size = unit(0.3, "cm"),plot.title = element_text(size=12, hjust = 0.5),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.text.x=element_text(size = 9), axis.text.y=element_text(size = 9), legend.key=element_blank(),
          axis.title.x=element_text(size=11), axis.title.y=element_text(size = 11)) +
  labs(title="Government", x="", y = "")+
  scale_y_continuous(expand =c(0,0), limits=c(0,1300), breaks=c(0, 250, 500, 750, 1000, 1250))+
  scale_x_continuous( breaks = seq(0, 100, 10))
p2



##Internal

int<-canada[canada$type=="Internal",]

myColors14<-(brewer.pal(9, "Blues"))
myColors14<-rev(myColors14[c(9, 5)])
colScale <- scale_fill_manual(name = "year",values = myColors14)

p3<-ggplot(int, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=10)  + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.922, 0.98),
          legend.key.size = unit(0.3, "cm"),plot.title = element_text(size=12, hjust = 0.5),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.text.x=element_text(size = 9), axis.text.y=element_text(size = 9), legend.key=element_blank(),
          axis.title.x=element_text(size=11), axis.title.y=element_text(size = 11)) +
  labs(title="Internal",x="% research funding", y = "Number of responses")+
  scale_y_continuous(expand =c(0,0), limits=c(0,1300), breaks=c(0, 250, 500, 750, 1000, 1250))+
  scale_x_continuous( breaks = seq(0, 100, 10))
p3



##Non-Governmental

ngov<-canada[canada$type=="Non-governmental",]

myColors14<-(brewer.pal(9, "Blues"))
myColors14<-rev(myColors14[c(9, 5)])
colScale <- scale_fill_manual(name = "year",values = myColors14)

p4<-ggplot(ngov, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=10)  + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.922, 0.98),
          legend.key.size = unit(0.3, "cm"),plot.title = element_text(size=12, hjust = 0.5),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.text.x=element_text(size = 9), axis.text.y=element_text(size = 9), legend.key=element_blank(),
          axis.title.x=element_text(size=11), axis.title.y=element_text(size = 11)) +
  labs(title="Non-governnmental", x="% research funding", y = "")+
  scale_y_continuous(expand =c(0,0), limits=c(0,1300), breaks=c(0, 250, 500, 750, 1000, 1250))+
  scale_x_continuous( breaks = seq(0, 100, 10))
p4


## Other

other<-canada[canada$type=="Other",]

myColors14<-(brewer.pal(9, "Blues"))
myColors14<-rev(myColors14[c(9, 5)])
colScale <- scale_fill_manual(name = "year",values = myColors14)

p5<-ggplot(other, aes(percent, fill=year))+ geom_histogram(position='dodge', binwidth=10)  + colScale +
   guides(fill=guide_legend(title=NULL)) +
    theme(legend.position=c(0.922, 0.98),
          legend.key.size = unit(0.3, "cm"),plot.title = element_text(size=12, hjust = 0.5),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.text.x=element_text(size = 9), axis.text.y=element_text(size = 9), legend.key=element_blank(),
          axis.title.x=element_text(size=11), axis.title.y=element_text(size = 11)) +
  labs(title="Other", x="% research funding", y = "")+
  scale_y_continuous(expand =c(0,0), limits=c(0,1300), breaks=c(0, 250, 500, 750, 1000, 1250))+
  scale_x_continuous( breaks = seq(0, 100, 10))
p5

##put them all together
require(gtable)
legend = gtable_filter(ggplotGrob(p1), "guide-box") 
grid.draw(legend)

grid.arrange(arrangeGrob(p1+ theme(legend.position="none"), p2,
                         p3+ theme(legend.position="none"), p4+ theme(legend.position="none"),
                         p5+ theme(legend.position="none"),
                         layout_matrix=rbind(c(1,1,1,2,2,2),c(3,3,4,4,5,5))))



```


<!--Part 4 - Funding Trends in your country of work-->
**4.4 Perspectives on the State of Fundamental Research in Canada**  

According to over half (69%) of Canadian researchers fundamental research is either very important (30%) or somewhat important (39%) to our government (Figure 4.15). At the same time, 68% of respondents said that applied research has become a higher priority for our government over the past decade while fundamental research is believed to be lowest priority (Figure 4.16). This high level of priority for applied research has most likely led to the disparity in funding amoung the research types. 

Canadians are not pessimistic about the future of research funding with the majority of respondents believing that funding will either stay the same or get better in the next five years for the three types of research types (Figure 4.17). The change over of the government is probably encouraging this thinking.  However, Applied funding still has the most optimistic outlooks. Seventeen percent of respondents think that funding for applied research will increase considerably whereas less than 5% of respondents believe that for either use-inspired or fundamental. Even with the majority of respondents thinking optimistically there was 30% of the respondents that believe that funding for fundamental research is going to decrease.  This belief is potentially due to th government prioritizing applied research.

Although respondents were generally optimistic about funding availabilty in the future they are not so when it comes to thinking about the impact this will have on future generations. Half of Canadian researchers (51%) think that the likelihood of the next generation pursuing careers in research will either decrease slightly or decrease considerably due to the influence of funding availability (Fig 4.18). 

```{r, echo=FALSE, fig.cap="Fig 4.15 Perceived importance of fundamental research to Canadian government. Researchers were asked how important they thought fundamental research was to the Canadian government. Responses were/were not significantly different between genders."}
## order bars from very important (left) to can't comment (right)
important<-subset(part4, select=c("Location","Country",'Country_work', "gender","opinion_fundamental_important"))

canada<-important[important$Country_work=="Canada" | (!(important$Country_work=="Canada") & important$Country_work=="" & important$Country=="Canada"),]

## using table to count cases of each category
sum.important<-data.frame(table(canada$opinion_fundamental_important))
# remove non-responses
sum.important<-sum.important[!sum.important$Var1=="",]
sum.important$Var1<-factor(sum.important$Var1, levels(sum.important$Var1)[c(6,5,4,3,2,1)])

perceive<-aggregate(Freq~Var1, sum.important, sum)

### colour palette

myColors15<-(brewer.pal(9, "Blues"))
myColors15<-(myColors15[c(4,4,4,4,4,4)])
colScale <- scale_fill_manual(name = "Var1",values = myColors15)

ggplot(data=perceive, aes(x=Var1, y=Freq, fill=Var1)) + 
      geom_bar(stat='identity', position='dodge')+ 
      labs(x="", y="Number of responses", fill="")+
      scale_x_discrete(labels=c("Very\n important", "Somewhat\n important", 'Not very\n important', 'Not at all\n important', "Can't\n comment"))+
      geom_text(aes(label=Freq, vjust=-0.5), size=3) + guides(fill=FALSE)+
      theme(aspect.ratio=3/4, axis.text.x = element_text(angle=0, vjust=0.4),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0,535)) + colScale
```

```{r, echo=FALSE, fig.cap="Fig 4.16 Perceived change in research priority by Canadian government. Researchers were asked whether any types of research had become higher priority for the Canadian government. Responses were/were not significantly different between genders."}
## order bars into applied > use > fundamental > no change
priority<-subset(part4, select=c("Location","Country",'Country_work', "gender", "high_priority_fundamental", "high_priority_use_inspired", "high_priority_applied", 
                                 "high_priority_no_change"))

canada<-priority[priority$Country_work=="Canada" | (!(priority$Country_work=="Canada") & priority$Country_work=="" & priority$Country=="Canada"),]

## switch to long format
priority.long<-gather(canada, what.type, higher.priority, -Location, -gender, -Country, -Country_work)
# remove non-responses (n = 1066)
priority.long<-priority.long[!priority.long$higher.priority=="",]
per.change<-aggregate(higher.priority~what.type, priority.long, sum)

# change order of the levels
per.change$what.type<-as.factor(per.change$what.type)
per.change$what.type<-factor(per.change$what.type, levels(per.change$what.type)[c(2,4,1,3)])

myColors16<-(brewer.pal(9, "Blues"))
myColors16<-(myColors16[c(4,4,4,4,4,4)])
colScale <- scale_fill_manual(name = "Var1",values = myColors16)

ggplot(data=per.change, aes(x=what.type, higher.priority, fill=what.type))+
        geom_bar(stat="identity", position='dodge')+ guides(fill=FALSE)+
        theme(aspect.ratio=3/4, axis.text.x = element_text(),
              axis.text.x = element_text(angle=45, vjust=0.4),
              panel.grid.major = element_blank(),
              panel.grid.minor = element_blank(), axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9)) +
        labs(x="", y="Number of responses", fill="") +
  scale_x_discrete(labels=c( "Fundamental", "Use-inspired","Applied", "No change"))   +
  geom_text(aes(label=higher.priority, vjust=-0.5), size=3) +scale_y_continuous(expand = c(0, 0), limits = c(0,1250))+ colScale
```

```{r, echo=TRUE, fig.cap="Fig 4.5 Anticipated future of research funding."  - 4.15 + 4.16}

###4.15
## order bars from very important (left) to can't comment (right)
important<-subset(part4, select=c("Location","Country",'Country_work', "gender","opinion_fundamental_important"))

canada<-important[important$Country_work=="Canada" | (!(important$Country_work=="Canada") & important$Country_work=="" & important$Country=="Canada"),]

## using table to count cases of each category
sum.important<-data.frame(table(canada$opinion_fundamental_important))
# remove non-responses
sum.important<-sum.important[!sum.important$Var1=="",]
sum.important$Var1<-factor(sum.important$Var1, levels(sum.important$Var1)[c(6,5,4,3,2,1)])

perceive<-aggregate(Freq~Var1, sum.important, sum)

### colour palette
myColors15<-(brewer.pal(9, "Blues"))
myColors15<-(myColors15[c(4,4,4,4,4,4)])
colScale <- scale_fill_manual(name = "Var1",values = myColors15)

p13<-ggplot(data=perceive, aes(x=Var1, y=Freq, fill=Var1)) + 
      geom_bar(stat='identity', position='dodge')+ 
      labs(x="", y="Number of responses", fill="")+
      scale_x_discrete(labels=c("Very\n important", "Somewhat\n important", 'Not very\n important', 'Not at all\n important', "Can't\n comment"))+
      geom_text(aes(label=Freq, vjust=-0.5), size=3) + guides(fill=FALSE)+
      theme(aspect.ratio=3/4, axis.text.x = element_text(angle=0, vjust=0.4),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(), axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0,545)) + colScale

###4.16
## order bars into applied > use > fundamental > no change
priority<-subset(part4, select=c("Location","Country",'Country_work', "gender", "high_priority_fundamental", "high_priority_use_inspired", "high_priority_applied", 
                                 "high_priority_no_change"))

canada<-priority[priority$Country_work=="Canada" | (!(priority$Country_work=="Canada") & priority$Country_work=="" & priority$Country=="Canada"),]

## switch to long format
priority.long<-gather(canada, what.type, higher.priority, -Location, -gender, -Country, -Country_work)
# remove non-responses (n = 1066)
priority.long<-priority.long[!priority.long$higher.priority=="",]
per.change<-aggregate(higher.priority~what.type, priority.long, sum)

# change order of the levels
per.change$what.type<-as.factor(per.change$what.type)
per.change$what.type<-factor(per.change$what.type, levels(per.change$what.type)[c(2,4,1,3)])
##colors
myColors16<-(brewer.pal(9, "Blues"))
myColors16<-(myColors16[c(4,4,4,4,4,4)])
colScale <- scale_fill_manual(name = "Var1",values = myColors16)

p14<-ggplot(data=per.change, aes(x=what.type, higher.priority, fill=what.type))+
        geom_bar(stat="identity", position='dodge')+ guides(fill=FALSE)+
        theme(aspect.ratio=3/4, axis.text.x = element_text(),
              axis.text.x = element_text(angle=45, vjust=0.4),
              panel.grid.major = element_blank(),
              panel.grid.minor = element_blank(), axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9)) +
        labs(x="", y="", fill="") +
  scale_x_discrete(labels=c( "Fundamental\n    ", "Use-inspired","Applied", "No change"))   +
  geom_text(aes(label=higher.priority, vjust=-0.5), size=3) +scale_y_continuous(expand = c(0, 0), limits = c(0,1250))+ colScale

grid.arrange(p13, p14, nrow=1)
```




```{r, echo=FALSE, fig.cap="Fig 4.17 Anticipated change in research funding in next five years in Canada. Researchers were asked whether the availability of research funding would change in the next five years, for each research category. Responses were/were not significantly different between genders. "}
## change in funding on the x-axis, and colours = type of research
## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
availability.change<-subset(part4, select=c("Location", "Country",'Country_work', "gender", "available_funding_fundamental",  
                                             "available_funding_use_inspired", "available_funding_applied"))

canada<-availability.change[availability.change$Country_work=="Canada" | (!(availability.change$Country_work=="Canada") & availability.change$Country_work=="" & availability.change$Country=="Canada"),]

## switch to long format
availability.change.long.ca<-gather(canada, what.type, level, -gender, -Location, -Country, -Country_work)
availability.ca<-with(availability.change.long.ca, data.frame(table(what.type, level)))

#remove non response
availability.ca<-availability.ca[!availability.ca$level=="",]

## change type to factor with levels
availability.ca$level<-str_replace_all(availability.ca$level, "Will ", "")
availability.ca$what.type<-as.factor(availability.ca$what.type)
availability.ca$level<-as.factor(availability.ca$level)

## change order of levels
availability.ca$level<-factor(availability.ca$level, levels(availability.ca$level)[c(4,5,6,3,2,1 )])
availability.ca$what.type<-factor(availability.ca$what.type, levels(availability.ca$what.type)[c(2,3,1)])

availability.ca$what.type<-revalue(availability.ca$what.type, c("available_funding_fundamental"="Fundamental",
              'available_funding_use_inspired'='Use-inspired', 'available_funding_applied' = 'Applied'))

### colour palette

myColors17<-mycols<-c('#1f78b4','#33a02c','#e31a1c')
colScale <- scale_fill_manual(name = "what.type",values = myColors17)

ggplot(data=availability.ca, aes(x=level, Freq, fill=what.type))+
    geom_bar(stat="identity", position="dodge")+
    theme(aspect.ratio=1/4, axis.text.x = element_text(angle=0, vjust=0.5, size = 9),
          panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
           strip.text.y = element_text(size=12, face="bold", color="black"),
          strip.background = element_rect(colour="white", fill="white"),
          legend.position=c(0.8, 0.2), axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9)) +
    guides(fill=FALSE)+
    labs(x="", y="Number of responses", fill="")+
    scale_x_discrete(labels=c("Increase\n considerably", "Increase\n slightly", 
                                    "Stay the same", "Decrease\n slightly", "Decrease\n considerably", "Can't\n comment"))+
    facet_wrap(~what.type,nrow=3)+
    geom_text(aes(label=Freq), vjust=-0.5, size=2.8) + colScale +
  scale_y_continuous(expand = c(0, 0), limits = c(0,580), breaks = seq(0,500,100))
```

```{r, echo=FALSE, fig.cap="Fig 4.18 Effect of change in research funding on research careers of next generation in Canada. Researchers were asked if they though that changes in funding availability would influence the likelihood of the next generation pursuing careers in research. Responses were/were not significantly different between genders."}

## order bars into increase considerably (left) to decrease considerably (right), then no comment at the far right
next.generation<-subset(part4, select=c("Location", "Country","Country_work", "gender","next_generation"))
# remove non-response
next.generation<-next.generation[!next.generation$next_generation=="",]
canada<-next.generation[next.generation$Country_work=="Canada" | (!(next.generation$Country_work=="Canada") & next.generation$Country_work=="" & next.generation$Country=="Canada"),]

impact<-data.frame(table(canada$next_generation))

## change type to factor with levels
impact$Var1<-str_replace_all(impact$Var1, "Will ", "")
impact$Var1<-as.factor(impact$Var1)
impact<-impact[!impact$Var1=="",]
impact<-droplevels(impact)
## change order of Var1s
impact$Var1<-factor(impact$Var1, levels(impact$Var1)[c(4,5,6,3,2,1)])
 
myColors18<-(brewer.pal(9, "Blues"))
myColors18<-(myColors18[c(4,4,4,4,4,4)])
colScale <- scale_fill_manual(name = "Var1",values = myColors18)

ggplot(data=impact, aes(x=Var1, Freq, fill=Var1))+ 
    geom_bar(stat='identity', position="dodge")  +
        scale_x_discrete(labels=c("Increase\n considerably", "Increase\n slightly", 
                                    "Stay the same", "Decrease\n slightly", "Decrease\n considerably", "Can't\n comment"))+
    guides(fill=FALSE) +
 labs(x="", y="Number of responses")+
  theme(aspect.ratio=3/4, axis.text.x = element_text(angle=0, vjust=0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
          axis.title.y=element_text(size=11), axis.text.x=element_text(size=9), axis.text.y=element_text(size=9))+
  geom_text(aes(label=Freq, vjust=-0.5), size=3)+
  scale_y_continuous(expand = c(0, 0), limits = c(0,345))+colScale
```

**Influence of gender, career stage, and dicipline on survey responses**  
*Gender*  
Gender did not have an impact on the responses for a majority of the responses.  However some questions did statistically show differences between the responses of Males, Females, and researchers who answered Other. When answering whether or not the level of partnership their research had outside of academia the responses for "Can't comment (new researcher)" did not fit the model (P = 0.001071) in a way that indicated that there was a smaller proportion of males that were new researches than females. 


*Dicipline*  


*Career Stage*  

Similar to gender, career stage did not impact the responses for most of the questions.  Senior academics reported that they had some or strong partnerships in the past significantly (p=0.001058) more than early academics did but this is understandable for the early academics most likely did not have the background or a fully developed research program to secure partnerships. 
