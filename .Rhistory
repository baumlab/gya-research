canada<-subset(part2.change, Country=="Canada")
change.part.ca<-data.frame(table(canada$partnership_change_10yrs))
change.part.ca$Var1<-revalue(change.part.ca$Var1, c("Can't comment (new researcher)"="Can't comment"))
change.part.ca$Var1<-factor(change.part.ca$Var1, levels=c("Yes", "No", "Can't comment"))
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 7,5)]
```{r, echo=FALSE, hide=TRUE, warning=FALSE, message=FALSE}
## load in survey data
## CHANGE WORKING DIRECTORY FOR YOUR LOCAL MACHINE BEFORE KNITTING ##
#setwd("/Users/kristinatietjen/Documents/git_hub/gya-research")
setwd("/Users/IMAC3/Documents/git-jpwrobinson/gya-research")
#setwd("/Users/Julia_2013MacBookAir/Desktop/GitRepos/gya-research")
survey.all<-read.csv("data/July 29-126pm-Hamilton.csv", header=TRUE)
survey<-read.csv(file="data/gya-without-incomplete.csv")
survey.what<-read.csv(file="data/gya-country-responses.csv")
research<-read.csv(file="data/gya-surveys-cleaned-research.csv")
#research.past<-read.csv(file="data/gya-surveys-cleaned-research-past.csv")
research.change<-read.csv(file="data/gya-change-reason.csv")
part4<-read.csv(file="data/gya-survey-part4.csv")
part2.b.a<-read.csv(file="data/gya-part2.before.after.csv")
part2.change<-read.csv(file="data/gya-part2.change.csv")
part2.reason<-read.csv(file="data/gya-part2.reason.csv")
part2.view<-read.csv(file="data/gya-part2.view.csv")
part1.view<-read.csv(file="data/gya-part1.view.csv")
part3.change<-read.csv(file="data/gya-part3.change.csv")
part3.grants.long<-read.csv(file="data/gya-part3.grants.long.csv")
part3.success.long<-read.csv(file="data/gya-part3.success.long.csv")
part3.prac.long<-read.csv(file="data/gya-part3.prac.long.csv")
part3.part.long<-read.csv(file="data/gya-part3.part.long.csv")
p3_master.long<-read.csv(file="data/gya-p3_master.long.csv")
## load required packages
require(gridExtra); require(tidyr); require(ggplot2); require(stringr);require(RColorBrewer); require(colorRamps); require(plotrix); require(plyr)
theme_set(theme_bw())
gender<-aggregate(Location ~ gender, survey, length)
country_work<-aggregate(gender ~ Country_work, survey, length)
locations<-aggregate(gender ~ Country, survey.what, length)
canada<-subset(part2.change, Country=="Canada")
change.part.ca<-data.frame(table(canada$partnership_change_10yrs))
change.part.ca$Var1<-revalue(change.part.ca$Var1, c("Can't comment (new researcher)"="Can't comment"))
change.part.ca$Var1<-factor(change.part.ca$Var1, levels=c("Yes", "No", "Can't comment"))
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 7,5)]
g1<-ggplot(data=change.part.ca, aes(x=Var1, y=Freq, fill=Var1))+
geom_bar(stat='identity') +
guides(fill=FALSE) +
labs(x="", y="No. of responses",title="")+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) + scale_fill_manual(name = "Var1",values = myColors)
### reason
reason.pt.long<-gather(part2.reason, change.reason, yes, -Country, -gender, -Location)
sum.canada<-data.frame(table(reason.pt.long$change.reason, reason.pt.long$yes))
sum.canada$Var1<-revalue(sum.canada$Var1, c("reason_partnership_change_career" = "Career", "reason_partnership_change_funding" = "Funding", "reason_partnership_change_interest" = "Interest", "reason_partnership_change_other" = "Other", "reason_partnership_change_socially"  = "Social"))
sum.canada$Var1<-reorder(sum.canada$Var1, -sum.canada$Freq)
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 8,7,6,5,3)]
g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) +
geom_bar(stat='identity')+  guides(fill=FALSE) +
theme(axis.text.x = element_text(angle=0, vjust=0.5),
legend.position=c(0.8, 0.8),
legend.title=element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
labs(x="", y="", title="")+scale_fill_manual(name = "Var1",values = myColors)
grid.arrange(g1, g2, nrow=1)
head(sum.canada)
sum.canada<-data.frame(table(reason.pt.long$change.reason, reason.pt.long$yes))
head(sum.canada)
head(reason.pt.long)
head(part2.reason)
reason.pt.long<-gather(part2.reason, change.reason, yes, -Country,-Country_work, -gender, -Location)
sum.canada<-data.frame(table(reason.pt.long$change.reason, reason.pt.long$yes))
sum.canada$Var1<-revalue(sum.canada$Var1, c("reason_partnership_change_career" = "Career", "reason_partnership_change_funding" = "Funding", "reason_partnership_change_interest" = "Interest", "reason_partnership_change_other" = "Other", "reason_partnership_change_socially"  = "Social"))
sum.canada$Var1<-reorder(sum.canada$Var1, -sum.canada$Freq)
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 8,7,6,5,3)]
g2<-ggplot(sum.canada, aes(x=Var1, y=Freq, fill=Var1)) +
geom_bar(stat='identity')+  guides(fill=FALSE) +
theme(axis.text.x = element_text(angle=0, vjust=0.5),
legend.position=c(0.8, 0.8),
legend.title=element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
labs(x="", y="", title="")+scale_fill_manual(name = "Var1",values = myColors)
grid.arrange(g1, g2, nrow=1)
canada<-subset(part2.view, Country=="Canada")
view<-data.frame(table(canada$view_change_partnership))
# change order of the levels
view$Var1<-factor(view$Var1, levels(view$Var1)[c(5,3,1,2,4)])
myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 8,7,6,5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors)
ggplot(change.view.ca, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+
geom_text(aes(label=Freq, vjust=-1))+
guides(fill=FALSE)+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text.x = element_text(angle=0, vjust=0.5)) +
labs(x="", y="No. of Responses") + colScale
canada<-subset(part2.view, Country=="Canada")
view<-data.frame(table(canada$view_change_partnership))
# change order of the levels
view$Var1<-factor(view$Var1, levels(view$Var1)[c(5,3,1,2,4)])
myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 8,7,6,5)])
colScale <- scale_fill_manual(name = "Var1",values = myColors)
ggplot(view, aes(x=Var1, y=Freq, fill=Var1)) + geom_bar(stat='identity')+
geom_text(aes(label=Freq, vjust=-1))+
guides(fill=FALSE)+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text.x = element_text(angle=0, vjust=0.5)) +
labs(x="", y="No. of Responses") + colScale
canada<-subset(part3.grants.long, Country=="Canada")
canada$type.grant<-as.character(canada$type.grant)
#add time variable
canada$time<-ifelse(grepl("11_15", canada$type.grant), "2011-2015", "2006-2010")
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_applied"]<-"Applied"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_applied"]<-"Applied"
grants.ca<-data.frame(with(canada, table(type.grant,time,number)))
grants.ca$type.grant<-as.factor(grants.ca$type.grant)
#change order of levels
grants.ca$number<-factor(grants.ca$number, levels(grants.ca$number)[c(1,2,6,7,3,4,5)])
grants.ca$type.grant<-factor(grants.ca$type.grant, levels(grants.ca$type.grant)[c(2,3,1)])
myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "time",values = myColors)
ggplot(grants.ca, aes(number, Freq, fill=time)) +
geom_bar(stat="identity", position = "dodge")+
facet_wrap(~type.grant, nrow=3) +
guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
labs(x="No. of grant applications", y="No. of responses")+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position=c(0.8, 0.2)) + colScale
```{r, echo=FALSE, fig.cap="Number of external research grant applications", warning=FALSE, fig.height=12}
canada<-subset(part3.grants.long, Country=="Canada")
canada$type.grant<-as.character(canada$type.grant)
#add time variable
canada$time<-ifelse(grepl("11_15", canada$type.grant), "2011-2015", "2006-2010")
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_fundamental"]<-"Fundamental"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_use"]<-"Use-Inspired"
canada$type.grant[canada$type.grant=="external_pi_grant_11_15_applied"]<-"Applied"
canada$type.grant[canada$type.grant=="external_pi_grant_6_10_applied"]<-"Applied"
grants.ca<-data.frame(with(canada, table(type.grant,time,number)))
grants.ca$type.grant<-as.factor(grants.ca$type.grant)
#change order of levels
grants.ca$number<-factor(grants.ca$number, levels(grants.ca$number)[c(1,2,6,7,3,4,5)])
grants.ca$type.grant<-factor(grants.ca$type.grant, levels(grants.ca$type.grant)[c(2,3,1)])
myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "time",values = myColors)
ggplot(grants.ca, aes(number, Freq, fill=time)) +
geom_bar(stat="identity", position = "dodge")+
facet_wrap(~type.grant, nrow=3) +
guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
labs(x="No. of grant applications", y="No. of responses")+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position=c(0.8, 0.2)) + colScale
canada<-subset(part3.success.long, Country=="Canada")
canada$type<-as.character(canada$type)
#add time variable
canada$time<-ifelse(grepl("11_15", canada$type), "2011-2015", "2006-2010")
canada$type[canada$type=="successful_grants_11_15_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_6_10_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_11_15_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_6_10_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_11_15_applied"]<-"Applied"
canada$type[canada$type=="successful_grants_6_10_applied"]<-"Applied"
success.ca<-data.frame(with(canada, table(type, percent,time)))
#change order of types
success.ca$type<-as.factor(success.ca$type)
success.ca$type<-factor(success.ca$type, levels(success.ca$type)[c(2,3,1)])
myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "time",values = myColors)
ggplot(success.ca, aes(percent, Freq, fill=time)) +
geom_bar(stat="identity", position = "dodge")+
facet_wrap(~type, nrow=3) +
guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
labs(x="% successful grants", y="No. of responses")+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position=c(0.8, 0.2)) + colScale
head(canada)
tial(canada)
tail(canada)
head(part3.success.long)
```{r, echo=FALSE, fig.cap="Percentage of research grant application success", warning=FALSE}
canada<-subset(part3.success.long, Country=="Canada")
canada$type<-as.character(canada$type)
head(canada)
canada$type[canada$type=="successful_grants_11_15_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_6_10_fundamental"]<-"Fundamental"
canada$type[canada$type=="successful_grants_11_15_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_6_10_use"]<-"Use-Inspired"
canada$type[canada$type=="successful_grants_11_15_applied"]<-"Applied"
canada$type[canada$type=="successful_grants_6_10_applied"]<-"Applied"
success.ca<-data.frame(with(canada, table(type, percent,time)))
#change order of types
success.ca$type<-as.factor(success.ca$type)
success.ca$type<-factor(success.ca$type, levels(success.ca$type)[c(2,3,1)])
myColors<-(brewer.pal(9, "Blues"))
myColors<-rev(myColors[c(9, 5)])
colScale <- scale_fill_manual(name = "time",values = myColors)
ggplot(success.ca, aes(percent, Freq, fill=time)) +
geom_bar(stat="identity", position = "dodge")+
facet_wrap(~type, nrow=3) +
guides(fill=guide_legend(title=NULL, reverse=FALSE)) +
labs(x="% successful grants", y="No. of responses")+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position=c(0.8, 0.2)) + colScale
canada<-subset(part3.prac.long, Country=="Canada")
canada$year<-as.character(canada$year)
canada$year[canada$year=="practical_applications_important_11_15"]<-"2011-2015"
canada$year[canada$year=="practical_applications_important_6_10"]<-"2006-2010"
prac.ca<-aggregate(gender~year+level, canada, length)
#change order of levels
prac.ca$level<-factor(prac.ca$level, levels(prac.ca$level)[c(2,6,4,5,3,1)])
ggplot(prac.ca, aes(level, gender, fill=year))+ geom_bar(stat="identity", position = "dodge")+theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
guides(fill=guide_legend(title=NULL, reverse=FALSE)) + labs(x="", y="Number of responses")+theme(axis.text.x = element_text(angle=90, vjust=0.5))
```
res.plot<-subset(research, type%in%c("percent_fundemental_research_current",  "percent_Applied_Research_current" , "percent_Use_inspired_Research_current","percent_Applied_Research_past",  "percent_Fundamental_Research_past" , "percent_Use_inspired_Research_past"))
res.plot$percent<-str_replace_all(res.plot$percent, "%", "")
res.plot$percent<-as.numeric(as.character(res.plot$percent))
res.plot$type<-as.character(res.plot$type)
# add time variable
res.plot$time<-ifelse(grepl( "current", res.plot$type),"Current", "Past")
res.plot$type[res.plot$type=="percent_Applied_Research_past"]<-"Applied"
res.plot$type[res.plot$type=="percent_Applied_Research_current"]<-"Applied"
res.plot$type[res.plot$type=="percent_Fundamental_Research_past"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_fundemental_research_current"]<-"Fundamental"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_past"]<-"Use inspired"
res.plot$type[res.plot$type=="percent_Use_inspired_Research_current"]<-"Use inspired"
# change order of the levels
res.plot$time<-as.factor(res.plot$time)
levels(res.plot$type)
class(res.plot$type)
res.plot$type<-as.factor(res.plot$type)
levels(res.plot$type)
ggplot(res.plot[res.plot$Country=="Canada",], aes(percent, fill=time)) +
geom_histogram(position='dodge', binwidth=10, bins=seq(0, 100, 10))  +
guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
labs(x="% funding", y="No. responses", title="")+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position=c(0.8, 0.2)) +
facet_wrap(~type, nrow=3) + colScale +
scale_x_continuous(breaks=seq(0,100,10))
res.plot$time<-factor(res.plot$time, levels(res.plot$time)[c(2,1)])
res.plot$type<-as.factor(res.plot$type)
res.plot$type<-factor(res.plot$type, levels(res.plot$type)[c(2,3,1)])
myColors<-(brewer.pal(9, "Blues"))
myColors<-myColors[c(9, 5)]
colScale <- scale_fill_manual(name = "time",values = myColors)
ggplot(res.plot[res.plot$Country=="Canada",], aes(percent, fill=time)) +
geom_histogram(position='dodge', binwidth=10, bins=seq(0, 100, 10))  +
guides(fill=guide_legend(title=NULL, reverse=FALSE, nrow=2)) +
labs(x="% funding", y="No. responses", title="")+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position=c(0.8, 0.2)) +
facet_wrap(~type, nrow=3) + colScale +
scale_x_continuous(breaks=seq(0,100,10))
